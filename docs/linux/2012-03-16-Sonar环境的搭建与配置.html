<!DOCTYPE html> <html lang="en"> <head> <meta charset="UTF-8"> <title>知不知</title> <meta name="viewport" content="width=device-width, initial-scale=1"> <meta name="theme-color" content="#157878"> <meta name="apple-itunes-app" content="app-id=1227288468, app-argument=https://luowei.github.io/list/docs/linux/2012-03-16-Sonar%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA%E4%B8%8E%E9%85%8D%E7%BD%AE.html"> <link rel="stylesheet" href="https://luowei.github.io/list/assets/css/normalize.css"> <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'> <link rel="stylesheet" href="https://luowei.github.io/list/assets/css/cayman.css"> </head> <body> <section class="page-header"> <h1 class="project-name">知不知</h1> <h2 class="project-tagline"><a style="color:#ffffff;" href="http://luowei.github.io/list">知不知</a> 是一个代码爱好者的技术知识分享部落格。</h2> <a href="http://wodedata.com" target="_blank" class="btn">wodedata</a> <a href="https://luowei.github.io/list" class="btn">home</a> <a href="http://app.wodedata.com" target="_blank" class="btn">APP作品</a> </section> <section class="main-content"> <!-- 标题 --> <h2>Sonar环境的搭建与配置</h2> <!-- Google Ads --> <script async="" src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <p><ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-8760692904992206" data-ad-slot="2948937366"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script></p> <h3 id="简单介绍">简单介绍</h3> <p>Hudson 是一个可扩展的持续集成引擎(Continuous Integration Engine)。主要用于：持续、自动地构建/ 测试软件项目. 监控一些定时执行的任务; Sonar 是一个开源的质量管理平台，专注于从项目到类方法的持续的分析和测量技术质量，它把代码质量相关软件集成到一起统一管理。</p> <p><strong>简单来说:</strong><br /> hudson 是持续、自动地构建/ 测试软件项目;而sonar 则是持续，自动地统计并分析软件项目的相关质量数据，例如单元测试的通过率，覆盖率，代码的复杂度，代码的行数等等，用于评估和度量软件项目质量。 <a href="http://sonar.codehaus.org/">Sonar</a> 是一个开源的代码质量管理平台，专注于对从项目组合到类方法的持续分析和度量其技术质量，当然你也可以使用开源的插件来扩展Sonar，查看扩展可以访问 <a href="http://sonar-plugins.codehaus.org/">open source plugins forge</a> 。<br /> 以下是sonar环境及相关技术的一个关联图：<br /> <img src="https://raw.githubusercontent.com/luowei/list/gh-pages/images/mine/sonar/01.jpg" alt="sonar" /></p> <p><strong>工具说明：</strong></p> <blockquote> <p>jacoco : is an Open Source and robust code coverage tool , Sonar is delivered with Cobertura plugin but if you prefer JaCoCo you just have to install this plugin and go back to your favorite practice : the test driven development.</p> <p>findbugs: a program which uses static analysis to look for bugs in Java code.</p> <p>Squid: Squid is a plugin that gathers all standard metrics number of classes, number of comments, cyclomatic complexity…). Originally, Sonar was using JavaNCSS, but they were too many limitations.Squid keeps by default methods and accessors (beans getters and setters) separated.</p> <p>PMD CPD : This is the historical engine to search for copy / paste. Mainly for performances reasons, it only enables to do copy / paste detection within a project and event within a maven module when maven is used.</p> </blockquote> <h4 id="第一步创建数据库">第一步.创建数据库</h4> <p>sornar默认就装载了Apache Derby ( an Apache DB subproject ) ，所以如果使用 Derby就 不需要安装;它只是用于演示和测试，在实际应用中还是用外部强健的数据库，更多详细见 <a href="http://docs.codehaus.org/display/SONAR/Requirements">supported platforms</a> 。</p> <p>要使用外部数据库，它要求明确建立 database schema 和 permission ，当第一次启动sonar 的时候，table 和 index会自动创建，例如设置使用的外部数据库为 MySql 数据库，可以用以下脚本：</p><pre><code class="language-mysql"># Create Sonar database and user.
#
# Command: mysql -u root -p &lt; create_database.sql
#
CREATE DATABASE sonar CHARACTER SET utf8 COLLATE utf8_general_ci;
CREATE USER 'sonar' IDENTIFIED BY 'sonar';
GRANT ALL ON sonar.* TO 'sonar'@'%' IDENTIFIED BY 'sonar';
GRANT ALL ON sonar.* TO 'sonar'@'localhost' IDENTIFIED BY 'sonar';
FLUSH PRIVILEGES;
</code></pre><p>下载地址： <a href="https://github.com/SonarSource/sonar/tree/master/sonar-application/src/main/assembly/extras/database/mysql">extras/database/mysql</a><br /> 注：当创建数据库时，Character Set 推荐使用utf-8 ,同时校验规则 Collation 是对大小写敏感。</p> <h4 id="第二步下载安装sonar">第二步.下载安装sonar</h4> <p>1.下载并解压它的发行版本 the distribution.<br /> 2.如果你使用sonar默认内嵌的Derby数据库，编辑 conf/sonar.properties文件配置对数据的访问，这个模板适用于所有支持的数据库，只需要注释掉derby专用的前四行，同取消对要引用外部数据库链接的注释。<br /> 原文如下：</p> <blockquote> <p>If you do not use the default embedded database, edit conf/sonar.properties to configure the database access. Templates are available for every supported database. Just uncomment them and comment the first four lines dedicated to derby. sonar.jdbc.url : the URL of the database sonar.jdbc.driver : the class of the driver sonar.jdbc.user : the username (default value is ‘sonar’) sonar.jdbc.password : the password (default value is ‘sonar’)</p> </blockquote> <p>Example for MySQL :</p><pre><code class="language-mysql">#sonar.jdbc.url: jdbc:derby://localhost:1527/sonar;create=true
#sonar.jdbc.driverClassName: org.apache.derby.jdbc.ClientDriver
#sonar.jdbc.defaultTransactionIsolation: 1
#sonar.jdbc.validationQuery: values(1)
sonar.jdbc.url: jdbc:mysql://localhost:3306/sonar?useUnicode=true&amp;characterEncoding=utf8
sonar.jdbc.driverClassName: com.mysql.jdbc.Driver
sonar.jdbc.validationQuery: select 1 
</code></pre><h4 id="第三步启动-sonar-应用">第三步.启动 sonar 应用</h4> <p>启动 sonar 应用，这里有几种方式：</p> <p><strong>Mode 1 - Start the standalone application</strong></p> <blockquote> <p>编辑conf/sonar.properties文件，<br /> 我这里设置的是：</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sonar.web.host : 192.168.5.28
sonar.web.port: 9000
sonar.web.context: /sonar
</code></pre></div> </div> </blockquote> <blockquote> <p>执行以下脚本，启动sonar服务; On Linux/Mac OS : bin/<YOUR OS="">/sonar.sh start On MS Windows : bin/windows-x86-32/StartSonar.bat Read "Install on AIX, HPUX or Solaris" for other platforms You can now browse to http://localhost:9000. 在浏览器中访问，如图：</YOUR></p> </blockquote> <p><img src="https://raw.githubusercontent.com/luowei/list/gh-pages/images/mine/sonar/02.jpg" alt="sonar" /><br /> <img src="https://raw.githubusercontent.com/luowei/list/gh-pages/images/mine/sonar/03.jpg" alt="sonar" /></p> <p><strong>Mode 2 - Deploy on JEE Server</strong><br /> sonar应用也可以打包成war布署到JEE server上，支持 Tomcat 5.x, 6.x, 7.x and Jetty 6.x 。</p> <p><strong>安装步骤：</strong></p> <blockquote> <p>1.Edit conf/sonar.properties as described in standalone mode. The file conf/wrapper.conf is never used when deploying to application server.<br /> 2.Execute the script build-war.sh (or build-war.bat on MS Windows) from the directory war/ .<br /> 3.Deploy war/sonar.war to the application server.<br /> 4.Browse to http://localhost/sonar and follow setup instructions.</p> </blockquote> <blockquote> <p>注：sonar要求的最小堆内存大小是512Mb,所以在启动tomcat之前，通过设置 CATALINA_OPTS,来增加tomcat的memory heap size。如,修改catalina.bat :</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>set CATALINA_OPTS=-Xmx1024m -Dorg.apache.jasper.runtime.BodyContentImpl.LIMIT_BUFFER=true -XX:MaxPermSize=256m
set set JAVA_HOME=C:\Program Files\Java\jdk1.6.0_24
Set JAVA_OPTS=-Xms512m -Xmx256m
</code></pre></div> </div> </blockquote> <p><strong>Mode 3 - Run as a service on MS Windows</strong></p> <blockquote> <p>Install/uninstall NT service (may have to run these batch files via “Run As Administrator”):</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bin/windows-x86-32/InstallNTService.bat
bin/windows-x86-32/UninstallNTService.bat
</code></pre></div> </div> <p>Start/stop the service :</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bin/windows-x86-32/StartNTService.bat
bin/windows-x86-32/StopNTService.bat
</code></pre></div> </div> </blockquote> <p><strong>Mode 4 - Run as a service on Linux</strong></p> <blockquote> <p>The following has been tested on Ubuntu 8.10. Create the file /etc/init.d/sonar with this content :</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#! /bin/sh</span>
/usr/bin/sonar <span class="nv">$*</span>
</code></pre></div> </div> <p>Register Sonar at boot time :</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo ln -s $SONAR_HOME/bin/linux-x86-32/sonar.sh /usr/bin/sonar
sudo chmod 755 /etc/init.d/sonar
sudo update-rc.d sonar defaults 
</code></pre></div> </div> </blockquote> <p><strong>Running Sonar behind Nginx</strong></p> <blockquote> <p>我们假设你已经安装了Nginx, 而sonar的虚拟主机(visual host)是使用 www.somecompany.com 并且sonar服务已启动，并且对应的 <a href="http://sonahost:sonarport/">http://sonahost:sonarport/</a>可用.<br /> 编辑Nginx配置文件. 将sonar的主机 <a href="http://www.somecompany.com/">http://www.somecompany.com/</a> 包含进来，如下:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># the server directive is nginx's virtual host directive
server {
  # port to listen on. Can also be set to an IP:PORT
  listen 80;
  # sets the domain[s] that this vhost server requests for
  server_name www.somecompany.com;
  location / {
    proxy_pass http://sonarhost:sonarport;
  }
}
</code></pre></div> </div> <p>Nginx configuration is going to vary based on your own application’s requirements and the way you intend to expose Sonar to the outside world. If you need more details about Nginx, please see <a href="http://nginx.org">http://nginx.org</a>.</p> </blockquote> <h4 id="配置多个tomcat">配置多个tomcat</h4> <blockquote> <ol> <li>下载压缩版的tomcat,</li> <li>增加环境变量CATALINA_HOME2，值为新的tomcat的地址；增加环境变量CATALINA_BASE2，值为新的tomcat的地址。</li> <li>修改新的tomcat中的startup.bat，把其中的CATALINA_HOME改为CATALINA_HOME2。</li> <li>修改新的tomcat中的catalina.bat，把其中的CATALINA_HOME改为CATALINA_HOME2，CATALINA_BASE改为CATALINA_BASE2。</li> <li>修改conf/server.xml文件,将已被占用的端口都修改掉。 注：</li> </ol> </blockquote> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;Connector port="8180" protocol="HTTP/1.1" 
connectionTimeout="20000"
redirectPort="8543" URIEncoding="UTF-8" /&gt;
</code></pre></div></div> <h4 id="maven环境的安装">Maven环境的安装</h4> <p>参考：<a href="http://maven.apache.org/download.html">http://maven.apache.org/download.html</a></p> <p><strong>Windows 2000/XP</strong></p> <blockquote> <ol> <li>解压apache-maven-3.0.4-bin.zip 到你指定的安装目录. 这里默认假设安装到 C:\Program Files\Apache Software Foundation.</li> <li>添加 M2_HOME = C:\Program Files\Apache Software Foundation\apache-maven-3.0.4. 不要有任何空格或引号. 注: Maven2.0.9以下版本, M2_HOME 的路径的值最后面不要有 ‘' .</li> <li>在同一个对话框中添加环境变量 M2 = %M2_HOME%\bin.</li> <li>可选: 添加环境变量 MAVEN_OPTS = -Xms256m -Xmx512m. =</li> <li>确保存在环境变量 JAVA_HOME = <YOU JDK="" INSTALL="" DIRECTORY="">\Java\jdk1.5.0_02 以及 %JAVA_HOME%\bin 也被添加到了 Path 环境变量中.</YOU></li> <li>打开命令行，运行 mvn –version 确认maven是否正确安装.<br /> 如下图：</li> </ol> </blockquote> <p><img src="https://raw.githubusercontent.com/luowei/list/gh-pages/images/mine/sonar/04.jpg" alt="sonar" /></p> <p><strong>Unix-based Operating Systems (Linux, Solaris and Mac OS X)</strong></p> <blockquote> <ol> <li>解压 apache-maven-3.0.4-bin.tar.gz 到你指定的安装目录，这里假设你安装到 /usr/local/apache-maven.</li> <li>在命令终端添加环境变量 M2_HOME ，例如 export M2_HOME=/usr/local/apache-maven/apache-maven-3.0.4.</li> <li>添加环境变量 M2 ，例如 export M2=$M2_HOME/bin.</li> <li>可选: 添加环境变量 MAVEN_OPTS 用来指JVM的属性, 例如 export MAVEN_OPTS=”-Xms256m -Xmx512m”.</li> <li>添加M2环境变量 M2 到你的 PATH环境变量中, 例如 export PATH=$M2:$PATH.</li> <li>确保 JAVA_HOME 正确的配置到了你的 JDK, 例如 export JAVA_HOME=/usr/java/jdk1.5.0_02，并且 $JAVA_HOME/bin 也添加到了你的环境变量 PATH 中.</li> <li>在终端运 mvn –version 确认Maven是否安装正确.</li> </ol> </blockquote> <h4 id="在maven中配置sonar">在maven中配置sonar</h4> <p><strong>全局配置</strong></p> <blockquote> <p>使用maven的插件让Sonar执行项目分析是最简单、使用最广泛的一种方式，To do so, you should edit settings.xml file, located into $MAVEN_HOME/conf or ~/.m2, and the database parameters to be used as well as the Sonar server URL。<br /> 例如：</p> </blockquote> <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;settings&gt;</span>
   <span class="nt">&lt;profiles&gt;</span>
      <span class="nt">&lt;profile&gt;</span>
      <span class="nt">&lt;id&gt;</span>sonar<span class="nt">&lt;/id&gt;</span>
      <span class="nt">&lt;activation&gt;</span>
       <span class="nt">&lt;activeByDefault&gt;</span>true<span class="nt">&lt;/activeByDefault&gt;</span>
      <span class="nt">&lt;/activation&gt;</span>
   <span class="nt">&lt;properties&gt;</span>
   <span class="c">&lt;!-- EXAMPLE FOR MYSQL --&gt;</span>
   <span class="nt">&lt;sonar.jdbc.url&gt;</span>
     jdbc:mysql://localhost:3306/sonar?useUnicode=true<span class="ni">&amp;amp;</span>characterEncoding=utf8
   <span class="nt">&lt;/sonar.jdbc.url&gt;</span>
   <span class="nt">&lt;sonar.jdbc.driverClassName&gt;</span>com.mysql.jdbc.Driver<span class="nt">&lt;/sonar.jdbc.driverClassName&gt;</span>
   <span class="nt">&lt;sonar.jdbc.username&gt;</span>sonar<span class="nt">&lt;/sonar.jdbc.username&gt;</span>
   <span class="nt">&lt;sonar.jdbc.password&gt;</span>sonar<span class="nt">&lt;/sonar.jdbc.password&gt;</span>
   <span class="c">&lt;!-- optional URL to server. Default value is http://localhost:9000 --&gt;</span>
   <span class="nt">&lt;sonar.host.url&gt;</span>
      http://localhost:8180/sonar <span class="cp">&lt;!—此处填访问sonar应用的url --&gt;</span>
   <span class="nt">&lt;/sonar.host.url&gt;</span>
  <span class="nt">&lt;/properties&gt;</span>
 <span class="nt">&lt;/profile&gt;</span>
 <span class="nt">&lt;/profiles&gt;</span>
<span class="nt">&lt;/settings&gt;</span>
</code></pre></div></div> <p><strong>分析一个由Maven构建的项目</strong></p> <blockquote> <p>分析一个Maven project,首先要在包含了pom.xml 文件的项目目录下，运行一个maven goal , maven goal的执行要在sonar分析之前执行，maven命令如下：</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mvn clean install -Dtest=false -DfailIfNoTests=false
mvn sonar:sonar
</code></pre></div> </div> <p>或者直接用这个命令：</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mvn clean install sonar:sonar -Dmaven.test.failure.ignore=true
</code></pre></div> </div> <p>如图：<br /> <img src="https://raw.githubusercontent.com/luowei/list/gh-pages/images/mine/sonar/05.jpg" alt="sonar" /> <br /> <img src="https://raw.githubusercontent.com/luowei/list/gh-pages/images/mine/sonar/06.jpg" alt="sonar" /> <br /> 注：ayyc 是一个maven project , ayyc目录下包含了pom.xml文件。</p> </blockquote> <p><strong>分析一个非maven构建的项目</strong></p> <blockquote> <p>其实，sonar可以分析任何一个Java项目，即使它不是由maven2构建的。当这个项目中配置了可用的xml文件(下面会它的内容格式) 以及收集这个项目的信息的sonar应用服务也被被配置好了，那么就可以分析这个项目的代码了(包括单元测试的代码)。<br /> 首先，安装 Maven2 (just unzip, define the $MAVEN_HOME property and add $MAVEN_HOME/bin to $PATH) <br /> 然后，在你的项目的根目录下创建一个名为 pom.xml 的文件。pom.xml如下编辑：</p> </blockquote> <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">"http://maven.apache.org/POM/4.0.0"</span>
         <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
         <span class="na">xsi:schemaLocation=</span><span class="s">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>[YOUR.ORGANIZATION]<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>[YOUR.PROJECT]<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;name&gt;</span>[YOUR PROJECT NAME]<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;version&gt;</span>[YOUR PROJECT VERSION]<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;build&gt;</span>
        <span class="nt">&lt;sourceDirectory&gt;</span>[YOUR SOURCE DIRECTORY]<span class="nt">&lt;/sourceDirectory&gt;</span>
        <span class="nt">&lt;outputDirectory&gt;</span>[YOUR CLASSES/BIN DIRECTORY<span class="nt">&lt;/outputDirectory&gt;</span>
        <span class="nt">&lt;plugins&gt;</span>
            <span class="nt">&lt;plugin&gt;</span>
                <span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>maven-compiler-plugin<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;configuration&gt;</span>
                    <span class="nt">&lt;source&gt;</span>1.5<span class="nt">&lt;/source&gt;</span>
                    <span class="nt">&lt;target&gt;</span>1.5<span class="nt">&lt;/target&gt;</span>
                    <span class="nt">&lt;excludes&gt;</span>
                        <span class="nt">&lt;exclude&gt;</span>**/*.*<span class="nt">&lt;/exclude&gt;</span>
                    <span class="nt">&lt;/excludes&gt;</span>
                <span class="nt">&lt;/configuration&gt;</span>
            <span class="nt">&lt;/plugin&gt;</span>
        <span class="nt">&lt;/plugins&gt;</span>
    <span class="nt">&lt;/build&gt;</span>
    <span class="nt">&lt;properties&gt;</span>
        <span class="nt">&lt;sonar.dynamicAnalysis&gt;</span>false<span class="nt">&lt;/sonar.dynamicAnalysis&gt;</span>
    <span class="nt">&lt;/properties&gt;</span>
<span class="nt">&lt;/project&gt;</span>
</code></pre></div></div> <p>这些参数代表的意义如下表：</p> <table> <tbody> <tr> <td>[YOUR.ORGANIZATION]</td> <td>the id of your organization (no space)</td> <td>com.myorganization</td> </tr> <tr> <td>[YOUR.PROJECT]</td> <td>the id of your project (no space)</td> <td>my.project</td> </tr> <tr> <td>[YOUR PROJECT NAME]</td> <td>the name displayed into sonar (spaces allowed)</td> <td>My Project</td> </tr> <tr> <td>[YOUR PROJECT VERSION]</td> <td>the version. Set 1.0 if no specific version.</td> <td>1.0</td> </tr> <tr> <td>[YOUR SOURCE DIRECTORY]</td> <td>the relative path to the sources directory</td> <td>src/java</td> </tr> <tr> <td>[YOUR CLASSES/BIN DIRECTORY]</td> <td>the relative path to the compiled java classes directory</td> <td>bin</td> </tr> </tbody> </table> <blockquote> <p>执行maven plugin,使用如下命令：<br /> <code class="highlighter-rouge">mvn sonar:sonar</code><br /> 如下图：</p> </blockquote> <p><img src="https://raw.githubusercontent.com/luowei/list/gh-pages/images/mine/sonar/07.jpg" alt="sonar" /></p> <blockquote> <p>注：在findbugs和sonar light模式下，findbugs会被激活，但是findbugs需要已被编译好的class文件，才能去找不合符规范的类。在maven项目下，findbugs默认尝试在target/classes目录下找; 如果你是用Ant生成的类，那么你需要在pom.xml文件中的”<sourceDirectory> 结点下添加"<outputDirectory>[YOUR CLASSES/BIN DIRECTORY]</outputDirectory>" ，另外你在还要在"<dependencies>"结点下为findbugs定义aux classpath，配置如下：</dependencies></sourceDirectory></p> </blockquote> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;dependency&gt;
    &lt;groupId&gt;deps&lt;/groupId&gt;
    &lt;artifactId&gt;dep1&lt;/artifactId&gt;
    &lt;version&gt;0.1&lt;/version&gt;
    &lt;scope&gt;system&lt;/scope&gt;
    &lt;systemPath&gt;${basedir}/web_app/WEB-INF/lib/struts.jar&lt;/systemPath&gt;
&lt;/dependency&gt;
</code></pre></div></div> <blockquote> <p>如果你少添加了依赖的jar包，就会看到有如下提示信息：<br /> The following classes needed for analysis were missing:<br /> org.springframework.jdbc.object.StoredProcedure<br /> org.displaytag.decorator.TableDecorator<br /> 更多详细内容请参见：<a href="http://docs.codehaus.org/display/SONAR/Analyse+with+Maven">http://docs.codehaus.org/display/SONAR/Analyse+with+Maven</a></p> </blockquote> <h4 id="hudson的安装配置">hudson的安装配置</h4> <p><strong>安装</strong></p> <blockquote> <p>第一步：把的hudson.war 包放到tomcat webapps下，然后启动tomcat;<br /> 第二步：在浏览器中输入http://hudsonhost:8080/hudson 如果出现正常页面表示Hudson 已经安装成功。<br /> 第三步：配置hudson,如下图：</p> </blockquote> <p><img src="https://raw.githubusercontent.com/luowei/list/gh-pages/images/mine/sonar/08.jpg" alt="sonar" /></p> <blockquote> <p>系统消息：可以理解为登录系统后的欢迎词，你可以写点随意的东西，然后弄个 Logo 图片什么的，它也支持 HTML 语言。</p> <p>生成前等待时间：这个值是表示你可以让你的构建有等待时间，以防止在提交代码的过程中去开始构建。这里是全局的变量，也可以在每个项目里面去设定。</p> <p>启用安全：这里是 hudson 权限的相应设置，如果想对每个用户进行相应的权限操作，选择 授权策略项下的”项目矩阵授权策略”这个选项就可以进行相应的设置了。<br /> <img src="https://raw.githubusercontent.com/luowei/list/gh-pages/images/mine/sonar/09.jpg" alt="sonar" /><br /> maven、jdk设置：就是取个名字，然后路径中指定 maven2 的解压路径。在这里设置时，去掉自动安装，直接指定 MAVEN_HOME（依个人设置）即可。</p> <p>注：选中hudson专有数据库，才能有用户注册的功能。</p> </blockquote> <p><strong>集成sonar</strong></p> <blockquote> <p>sonar搭建好后，进入sonar插件的安装：</p> </blockquote> <blockquote> <ol> <li>进入Hudson的系统管理-&gt;的插件管理，进入”可用插件”，选择sonar( Hudson Sonar Plugin) 插件，在页面右下角（最下面）点击安装，页面提示成功，重启hudson ，插件就生效了。如下图：</li> </ol> </blockquote> <p><img src="https://raw.githubusercontent.com/luowei/list/gh-pages/images/mine/sonar/10.jpg" alt="sonar" /></p> <blockquote> <ol> <li>配置sonar插件，在 系统配置 页面找到Sonar，配置sonar的系统信息，如下图：</li> </ol> </blockquote> <p><img src="https://raw.githubusercontent.com/luowei/list/gh-pages/images/mine/sonar/11.jpg" alt="sonar" /></p> <blockquote> <p>3.新建一个hudson Job，配置构建选项，如下图：</p> </blockquote> <p><img src="https://raw.githubusercontent.com/luowei/list/gh-pages/images/mine/sonar/12.jpg" alt="sonar" /></p> <blockquote> <p>配置项目关联到sonar,如下图：</p> </blockquote> <p><img src="https://raw.githubusercontent.com/luowei/list/gh-pages/images/mine/sonar/13.jpg" alt="sonar" /></p> <h4 id="svn服务端的安装配置">svn服务端的安装配置</h4> <p>在windows下安装，首先，下载svn服务端，直接安装，完成后，配置svn的数据仓库，如下：</p> <blockquote> <ol> <li>创建SVN储存库(repository)，可以选择命令行方式或者通过TortoiseSVN插件进行GUI操作，命令行运行：<code class="highlighter-rouge">svnadmin create E:\svn\repository</code> 。</li> <li> <p>repository创建完毕后会在目录下生成若干个文件和文件夹，dav目录是提供给Apache与mod_dav_svn使用的目录，让它们存储内部 数据；db目录就是所有版本控制的数据文件；hooks目录放置hook脚本文件的目录；locks用来放置Subversion文件库锁定数据的目录， 用来追踪存取文件库的客户端；format文件是一个文本文件，里面只放了一个整数，表示当前文件库配置的版本号。</p> </li> <li>打开svnserve.conf,找到： <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># [general]  
# anon-access = read  
# auth-access = write  
# password-db = passwd  
</code></pre></div> </div> <p>去之每行开头的#，password-db = passwd第二行是指定身份验证的文件名，即passwd文件.</p> </li> <li>同样打开passwd文件，找到： <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># [users]  
# harry = harryssecret  
# sally = sallyssecret  
</code></pre></div> </div> <p>把这几行的开头#字符去掉，这是设置用户，一行一个，存储格式为”用户名 = 密码”.</p> </li> <li>设置服务<br /> 安装服务<br /> <code class="highlighter-rouge">sc create subversion_service binpath= "c:\subversion\bin\svnserve.exe --service -r c:\svn_test\repos" displayname= "Subversion Repository" depend= Tcpip</code><br /> 删除服务<br /> <code class="highlighter-rouge">sc delete subversion_service</code></li> </ol> <p>6.svn目录设置</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>trunk——主干：这里存放的是最新稳写的源码，权限为项目组长可写，其它任何人有可读的权限。  
branches——开发分支：这里存放的是各开发中的版本，权限为任何开发人员可写，其它任何人不可读。  
tags——快照发布版本：这里存放的是临时发布的版本，权限为任何开发人员可写，其它任何人不可读。  
developer-resources——开发资源：这里存放的是开发者所需的开发资源，如：各类公用类库、.jar等。  
</code></pre></div> </div> </blockquote> <p><strong>在eclipse安装各种插件</strong></p> <blockquote> <p>将要安装的插件包中的features与plugins，解压到<code class="highlighter-rouge">&lt;YOUR INSTALL PATH&gt; \Genuitec\MyEclipse 8.5\dorpins\plugin_name</code>目录下，并在此目录下建立一个plugin_name.link,文件内容是：<code class="highlighter-rouge">path=&lt;YOUR INSTALL PATH&gt; \Genuitec\MyEclipse 8.5\dorpins\plugin_name</code>.</p> <p>例如安装svn插件，即可在此目录下建立一个svn的文件夹，将插件包中的features与plugins，拷到此目录下，并在此目录，新建一个svn.link的文件，文件内容是：<code class="highlighter-rouge">path=&lt;YOUR INSTALL PATH&gt; \Genuitec\MyEclipse 8.5\dorpins\svn.link</code>.</p> <p>下载地址：<code class="highlighter-rouge">\\192.168.1.201\wap\技术资源共享\sonar\eclipse-plugins</code>，包括：<code class="highlighter-rouge">subclispe ，eclipseplugin-checkstyle，sonar eclipse，pmd，m2eclipse</code>.</p> </blockquote> <h4 id="eclipse中的各项配置">eclipse中的各项配置</h4> <p><strong>sonar的配置</strong></p> <p>指定sonar server</p> <blockquote> <p>当安装好了sonar-eclipse插件后，可以在 Eclipse 全局 Preferences 窗口中看到，编辑后，如下图：</p> </blockquote> <p><img src="https://raw.githubusercontent.com/luowei/list/gh-pages/images/mine/sonar/14.jpg" alt="sonar" /></p> <p>连一个projects到sonar server</p> <blockquote> <p>1.在 Package explore 对要连接到sonar server的项目右击，选择”Configure -&gt; Associate with Sonar…” :</p> </blockquote> <p><img src="https://raw.githubusercontent.com/luowei/list/gh-pages/images/mine/sonar/15.jpg" alt="sonar" /><br /> <img src="https://raw.githubusercontent.com/luowei/list/gh-pages/images/mine/sonar/16.jpg" alt="sonar" /></p> <blockquote> <p>注：Q: when i go to eclipse configure&gt;associate with sonar says that my groupId is empty？<br /> A: There few things to check:<br /> Check the groupId is actually there in your pom.xml.<br /> Check that the artifactId and the eclipse project name are the same.<br /> Check that you typed groupId and artifactId in the associate with sonar dialog window. Then click find on server.<br /> Also make sure that the sonar plugin is set up on your eclipse (by going to Windows-&gt;Preferences-&gt;Sonar).</p> </blockquote> <p>关联好后，在项目上点击右键，选择，如下图：<br /> <img src="https://raw.githubusercontent.com/luowei/list/gh-pages/images/mine/sonar/17.jpg" alt="sonar" /><br /> sonar分析此项目的情况，如下图：<br /> <img src="https://raw.githubusercontent.com/luowei/list/gh-pages/images/mine/sonar/18.jpg" alt="sonar" /><br /> 在Dashboard标签下，可以看到ttpod-ayyc的代码的行数、类的个数、注释所占百分比等信息。</p> <p><span class="site-footer-credits">版权所有，转载请注明出处 <a href="https://luowei.github.io/list">luowei.github.io</a>.</span></p> <link rel="stylesheet" href="/list/assets/css/font-awesome.min.css?ver=20151122" /> <!--[if IE 7 ]><link rel="stylesheet" href="/list/assets/css/font-awesome-ie7.min.css?ver=20151122"><![endif]--> <div style="float: right"> <span id="share"> <a class="wechat" target="_blank" title="分享到微信" href="https://chart.apis.google.com/chart?cht=qr&amp;chs=300x300&amp;chl=https%3A%2F%2Fluowei.github.io%2Flist%2Fdocs%2Flinux%2F2012-03-16-Sonar%25E7%258E%25AF%25E5%25A2%2583%25E7%259A%2584%25E6%2590%25AD%25E5%25BB%25BA%25E4%25B8%258E%25E9%2585%258D%25E7%25BD%25AE.html"><i class="icon-large icon-wechat"></i></a> <a class="weibo" target="_blank" title="分享到微博" href="http://service.weibo.com/share/share.php?title=Sonar环境的搭建与配置 - 知不知&amp;url=https%3A%2F%2Fluowei.github.io%2Flist%2Fdocs%2Flinux%2F2012-03-16-Sonar%25E7%258E%25AF%25E5%25A2%2583%25E7%259A%2584%25E6%2590%25AD%25E5%25BB%25BA%25E4%25B8%258E%25E9%2585%258D%25E7%25BD%25AE.html&amp;type=3&amp;searchPic=1"><i class="icon-large icon-weibo"></i></a> <a class="qzone" target="_blank" title="分享到 QQ 空间" href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=https%3A%2F%2Fluowei.github.io%2Flist%2Fdocs%2Flinux%2F2012-03-16-Sonar%25E7%258E%25AF%25E5%25A2%2583%25E7%259A%2584%25E6%2590%25AD%25E5%25BB%25BA%25E4%25B8%258E%25E9%2585%258D%25E7%25BD%25AE.html&amp;title=Sonar环境的搭建与配置 - 知不知&amp;summary=Sonar环境的搭建与配置&amp;site=/list"><i class="icon-large icon-qzone"></i></a> <a class="twitter" target="_blank" title="Share to Twitter" href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fluowei.github.io%2Flist%2Fdocs%2Flinux%2F2012-03-16-Sonar%25E7%258E%25AF%25E5%25A2%2583%25E7%259A%2584%25E6%2590%25AD%25E5%25BB%25BA%25E4%25B8%258E%25E9%2585%258D%25E7%25BD%25AE.html&amp;text=Sonar环境的搭建与配置 - 知不知&amp;via=luowei010101"><i class="icon-large icon-twitter"></i></a> <a class="facebook" target="_blank" title="Share to Facebook" href="https://www.facebook.com/sharer.php?u=https%3A%2F%2Fluowei.github.io%2Flist%2Fdocs%2Flinux%2F2012-03-16-Sonar%25E7%258E%25AF%25E5%25A2%2583%25E7%259A%2584%25E6%2590%25AD%25E5%25BB%25BA%25E4%25B8%258E%25E9%2585%258D%25E7%25BD%25AE.html&amp;t=Sonar环境的搭建与配置 - 知不知"><i class="icon-large icon-facebook-sign"></i></a> <a class="googleplus" target="_blank" title="Share to Google+" href="https://plus.google.com/share?url=https%3A%2F%2Fluowei.github.io%2Flist%2Fdocs%2Flinux%2F2012-03-16-Sonar%25E7%258E%25AF%25E5%25A2%2583%25E7%259A%2584%25E6%2590%25AD%25E5%25BB%25BA%25E4%25B8%258E%25E9%2585%258D%25E7%25BD%25AE.html"><i class="icon-large icon-google-plus-sign"></i></a> </span> </div> <hr /> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css" /> <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script> <div id="gitalk-container"></div> <script type="text/javascript"> var gitalk = new Gitalk({ clientID: '9d5ee666269c252cf949', clientSecret: '728cd598f1fca9d8c1df1dfa300057883a3a8676', repo: 'list', owner: 'luowei', admin: ['luowei'], id: decodeURI('Sonar环境的搭建与配置'), distractionFreeMode: false }); gitalk.render('gitalk-container'); </script> <script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? "https://" : "http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1277627361'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s96.cnzz.com/z_stat.php%3Fid%3D1277627361%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));</script> <footer class="site-footer"> <span class="site-footer-owner"><a href="https://luowei.github.io/list">知不知</a> is maintained by <a href="http://luowei.github.io/list">luowei</a>.</span> <span class="site-footer-credits">Developed by <a href="https://luowei.github.io">luowei</a>.</span> </footer> </section> </body> </html>
