<!DOCTYPE html> <html lang="en"> <head> <meta charset="UTF-8"> <title>知不知</title> <meta name="viewport" content="width=device-width, initial-scale=1"> <meta name="theme-color" content="#157878"> <meta name="baidu-site-verification" content="" /> <meta name="apple-itunes-app" content="app-id=1227288468, app-argument=https://luowei.github.io/list/docs/linux/2015-09-05-Apache%E8%99%9A%E6%8B%9F%E7%9B%AE%E5%BD%95%E8%BD%AC%E5%8F%91%E5%8F%8A%E9%98%B2%E7%9B%97%E9%93%BE%E9%85%8D%E7%BD%AE.html"> <link rel="stylesheet" href="https://luowei.github.io/list/assets/css/normalize.css"> <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'> <link rel="stylesheet" href="https://luowei.github.io/list/assets/css/cayman.css"> </head> <body> <section class="page-header"> <h1 class="project-name">知不知</h1> <h2 class="project-tagline"><a style="color:#ffffff;" href="http://luowei.github.io/list">知不知</a> 是一个代码爱好者的技术知识分享部落格。</h2> <a href="http://wodedata.com" target="_blank" class="btn">wodedata</a> <a href="https://luowei.github.io/list" class="btn">home</a> <a href="http://app.wodedata.com" target="_blank" class="btn">APP作品</a> </section> <section class="main-content"> <!-- 标题 --> <h2>Apache虚拟目录转发及防盗链配置</h2> <!-- Google Ads --> <script async="" src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <p><ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-8760692904992206" data-ad-slot="2948937366"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script></p> <p>在上网，或在浏览器输入网址时，细心的就会发现，这个网址有很大的学问。一般网站都是通过域来访问的，一些相关的站点就配置了相应的子域名，如本站主域名为：<code class="language-plaintext highlighter-rouge">wodedata.com</code> ,其他相关的站点就配置了子域名进行访问，如：<code class="language-plaintext highlighter-rouge">my.wodedata.com</code>,<code class="language-plaintext highlighter-rouge">life.wodedata.com</code>,<code class="language-plaintext highlighter-rouge">fdm.wodedata.com</code>等等。 在购买了域名之后，就可以设置无数个子域名了。当然还有一种方式是在域名后面以<code class="language-plaintext highlighter-rouge">/</code>分隔，设置不路径指向不同的网站内容。 当然还有一种情况就是，java写的web项目布署在tomcat当中，百tomcat服务器不是80端口访问，如果又不想在域名后面加上一个8080端口直接暴露出来，就需要在Apache中设置代理转发到指定端口了。</p> <p>首先万网添加域名解析A记录:<code class="language-plaintext highlighter-rouge">img.wodeata.com</code> 到指定IP地址，然后。。废话不多说了直接上配置代码</p> <h3 id="虚拟目录及域名关联">虚拟目录及域名关联</h3> <ol> <li>在CentOS中，直接在conf.d目录下添加一个img.wodedata.com.conf文件；</li> <li>在Ubuntu中，直接在sites-avaliable目录下添加img.wodedata.com.conf文件；</li> <li>开启Apache的rewrite模块；</li> </ol> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;VirtualHost *:80&gt;
	ServerAdmin luowei@wodedata.com
	ServerName img.wodedata.com  
	ServerAlias img.wodedata.com  

	# 指定资源目录
	DocumentRoot /var/www/img.wodedata.com

	# 配置防盗链
	RewriteEngine on
	RewriteCond %{HTTP_REFERER} !^$ [NC]
	RewriteCond %{HTTP_REFERER} !wodedata.com [NC]
	RewriteCond %{HTTP_REFERER} !rootls.com [NC]
	RewriteCond %{HTTP_REFERER} !baidu.com [NC]
	RewriteCond %{HTTP_REFERER} !google.cn [NC]
	RewriteCond %{HTTP_REFERER} !google.com [NC]
	RewriteRule .*.(json|txt|doc|pdf|mp3|mp4|zip|rar|bmp|png|jpg|gif)$ http://wodedata.com [R,NC,L]

	# 配置日志生成目录
	ErrorLog ${APACHE_LOG_DIR}/error.log
	CustomLog ${APACHE_LOG_DIR}/access.log combined
&lt;/VirtualHost&gt;

</code></pre></div></div> <h3 id="tomcat端口转发配置">Tomcat端口转发配置</h3> <ol> <li>在CentOS中，直接在conf.d目录下添加一个my.wodedata.com.conf文件；</li> <li>在Ubuntu中，直接在sites-avaliable目录下添加my.wodedata.com.conf文件；</li> <li>开启Apache的proxy模块；</li> </ol> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> &lt;VirtualHost *:80&gt;   
    ServerName my.wodedata.com 
    ProxyIOBufferSize 8192  
    ProxyRequests Off   
    ProxyVia Full   
    ProxyPass / http://wodedata.com:8080/ smax=5 max=20 ttl=120 retry=300    # 代理到8080端口
    ProxyPassReverse / http://wodedata.com:8080/

    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined
&lt;/VirtualHost&gt;  
 

</code></pre></div></div> <p><span class="site-footer-credits">版权所有，转载请注明出处 <a href="https://luowei.github.io/list">luowei.github.io</a>.</span></p> <link rel="stylesheet" href="/list/assets/css/font-awesome.min.css?ver=20151122" /> <!--[if IE 7 ]><link rel="stylesheet" href="/list/assets/css/font-awesome-ie7.min.css?ver=20151122"><![endif]--> <div style="float: right"> <span id="share"> <a class="wechat" target="_blank" title="分享到微信" href="https://chart.apis.google.com/chart?cht=qr&amp;chs=300x300&amp;chl=https%3A%2F%2Fluowei.github.io%2Flist%2Fdocs%2Flinux%2F2015-09-05-Apache%25E8%2599%259A%25E6%258B%259F%25E7%259B%25AE%25E5%25BD%2595%25E8%25BD%25AC%25E5%258F%2591%25E5%258F%258A%25E9%2598%25B2%25E7%259B%2597%25E9%2593%25BE%25E9%2585%258D%25E7%25BD%25AE.html"><i class="icon-large icon-wechat"></i></a> <a class="weibo" target="_blank" title="分享到微博" href="http://service.weibo.com/share/share.php?title=Apache虚拟目录转发及防盗链配置 - 知不知&amp;url=https%3A%2F%2Fluowei.github.io%2Flist%2Fdocs%2Flinux%2F2015-09-05-Apache%25E8%2599%259A%25E6%258B%259F%25E7%259B%25AE%25E5%25BD%2595%25E8%25BD%25AC%25E5%258F%2591%25E5%258F%258A%25E9%2598%25B2%25E7%259B%2597%25E9%2593%25BE%25E9%2585%258D%25E7%25BD%25AE.html&amp;type=3&amp;searchPic=1"><i class="icon-large icon-weibo"></i></a> <a class="qzone" target="_blank" title="分享到 QQ 空间" href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=https%3A%2F%2Fluowei.github.io%2Flist%2Fdocs%2Flinux%2F2015-09-05-Apache%25E8%2599%259A%25E6%258B%259F%25E7%259B%25AE%25E5%25BD%2595%25E8%25BD%25AC%25E5%258F%2591%25E5%258F%258A%25E9%2598%25B2%25E7%259B%2597%25E9%2593%25BE%25E9%2585%258D%25E7%25BD%25AE.html&amp;title=Apache虚拟目录转发及防盗链配置 - 知不知&amp;summary=Apache虚拟目录、域名关联、端口转发以及防盗链配置&amp;site=/list"><i class="icon-large icon-qzone"></i></a> <a class="twitter" target="_blank" title="Share to Twitter" href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fluowei.github.io%2Flist%2Fdocs%2Flinux%2F2015-09-05-Apache%25E8%2599%259A%25E6%258B%259F%25E7%259B%25AE%25E5%25BD%2595%25E8%25BD%25AC%25E5%258F%2591%25E5%258F%258A%25E9%2598%25B2%25E7%259B%2597%25E9%2593%25BE%25E9%2585%258D%25E7%25BD%25AE.html&amp;text=Apache虚拟目录转发及防盗链配置 - 知不知&amp;via=luowei010101"><i class="icon-large icon-twitter"></i></a> <a class="facebook" target="_blank" title="Share to Facebook" href="https://www.facebook.com/sharer.php?u=https%3A%2F%2Fluowei.github.io%2Flist%2Fdocs%2Flinux%2F2015-09-05-Apache%25E8%2599%259A%25E6%258B%259F%25E7%259B%25AE%25E5%25BD%2595%25E8%25BD%25AC%25E5%258F%2591%25E5%258F%258A%25E9%2598%25B2%25E7%259B%2597%25E9%2593%25BE%25E9%2585%258D%25E7%25BD%25AE.html&amp;t=Apache虚拟目录转发及防盗链配置 - 知不知"><i class="icon-large icon-facebook-sign"></i></a> <a class="googleplus" target="_blank" title="Share to Google+" href="https://plus.google.com/share?url=https%3A%2F%2Fluowei.github.io%2Flist%2Fdocs%2Flinux%2F2015-09-05-Apache%25E8%2599%259A%25E6%258B%259F%25E7%259B%25AE%25E5%25BD%2595%25E8%25BD%25AC%25E5%258F%2591%25E5%258F%258A%25E9%2598%25B2%25E7%259B%2597%25E9%2593%25BE%25E9%2585%258D%25E7%25BD%25AE.html"><i class="icon-large icon-google-plus-sign"></i></a> </span> </div> <hr /> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css" /> <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script> <div id="gitalk-container"></div> <script type="text/javascript"> var gitalk = new Gitalk({ clientID: '9d5ee666269c252cf949', clientSecret: '728cd598f1fca9d8c1df1dfa300057883a3a8676', repo: 'list', owner: 'luowei', admin: ['luowei'], id: decodeURI('Apache虚拟目录转发及防盗链配置'), distractionFreeMode: false }); gitalk.render('gitalk-container'); </script> <script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? "https://" : "http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1277627361'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s96.cnzz.com/z_stat.php%3Fid%3D1277627361%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));</script> <footer class="site-footer"> <span class="site-footer-owner"><a href="https://luowei.github.io/list">知不知</a> is maintained by <a href="http://luowei.github.io/list">luowei</a>.</span> <span class="site-footer-credits">Developed by <a href="https://luowei.github.io/list">luowei</a>.</span> </footer> </section> </body> </html>
