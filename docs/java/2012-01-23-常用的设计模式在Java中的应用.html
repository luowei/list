<!DOCTYPE html> <html lang="en"> <head> <meta charset="UTF-8"> <title>知不知</title> <meta name="viewport" content="width=device-width, initial-scale=1"> <meta name="theme-color" content="#157878"> <meta name="baidu-site-verification" content="" /> <meta name="apple-itunes-app" content="app-id=1227288468, app-argument=https://luowei.github.io/list/docs/java/2012-01-23-%E5%B8%B8%E7%94%A8%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%9C%A8Java%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8.html"> <link rel="stylesheet" href="https://luowei.github.io/list/assets/css/normalize.css"> <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'> <link rel="stylesheet" href="https://luowei.github.io/list/assets/css/cayman.css"> </head> <body> <section class="page-header"> <h1 class="project-name">知不知</h1> <h2 class="project-tagline"><a style="color:#ffffff;" href="http://luowei.github.io/list">知不知</a> 是一个代码爱好者的技术知识分享部落格。</h2> <a href="http://wodedata.com" target="_blank" class="btn">wodedata</a> <a href="https://luowei.github.io/list" class="btn">home</a> <a href="http://app.wodedata.com" target="_blank" class="btn">APP作品</a> </section> <section class="main-content"> <!-- 标题 --> <h2>Java-常用的设计模式在Java中的应用</h2> <!-- Google Ads --> <script async="" src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <p><ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-8760692904992206" data-ad-slot="2948937366"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script></p> <p><strong>主要内容</strong>： 包括三个部分：第一部分：策略、代理模式、枚举、反射、注解；第二部分：观察者模式、内部类、输入输出；第三部分：模板方法模式、适配器模式、命令模式以及组合模式在JUnit中的应用；</p> <h2 id="第一部分策略代理模式枚举反射注解">第一部分：策略、代理模式、枚举、反射、注解</h2> <h3 id="一个简单策略模式示例的实现">一个简单策略模式示例的实现</h3> <p><strong>1.策略模式的组成</strong><br /> <img src="https://raw.githubusercontent.com/luowei/list/gh-pages/images/java/mynote/20.jpg" alt="DesignPattern" /></p> <p><strong>2.策略模式的实现</strong><br /> <img src="https://raw.githubusercontent.com/luowei/list/gh-pages/images/java/mynote/21.jpg" alt="DesignPattern" /></p> <p><strong>3.策略械的编写步骤</strong><br /> <img src="https://raw.githubusercontent.com/luowei/list/gh-pages/images/java/mynote/22.jpg" alt="DesignPattern" /></p> <p>注：java中的Collections 就是策略模式的一个实现, 其中的很多方法通过传入不同的比较器，实现不同形式的比较。</p> <p><strong>4.定义一个实体类</strong></p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">strategy</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Person</span><span class="o">{</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">age</span><span class="o">;</span>
    <span class="err">…………</span><span class="n">get</span><span class="o">/</span><span class="n">set</span><span class="err">方法…………</span>
<span class="o">}</span>
</code></pre></div></div> <p><strong>5.定义策略接口</strong></p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">strategy</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">SortInterface</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">sort</span><span class="o">(</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div> <p><strong>6.具体的策略类</strong><br /> 1.根据名字升序</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">strategy</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Comparator</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UpNameSort</span> <span class="kd">implements</span> <span class="nc">SortInterface</span><span class="o">,</span> <span class="nc">Comparator</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">sort</span><span class="o">(</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">list</span><span class="o">,</span> <span class="k">this</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compare</span><span class="o">(</span><span class="nc">Person</span> <span class="n">o1</span><span class="o">,</span> <span class="nc">Person</span> <span class="n">o2</span><span class="o">){</span>
        <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="n">o1</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">compareTo</span><span class="o">(</span><span class="n">o2</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
        <span class="k">if</span><span class="o">(</span><span class="mi">0</span> <span class="o">==</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">o1</span><span class="o">.</span><span class="na">getId</span><span class="o">()</span> <span class="o">-</span> <span class="n">o2</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>2.根据名字降序</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">strategy</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Comparator</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DownNameSort</span> <span class="kd">implements</span> <span class="nc">SortInterface</span><span class="o">,</span> <span class="nc">Comparator</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">sort</span><span class="o">(</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">list</span><span class="o">,</span> <span class="k">this</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compare</span><span class="o">(</span><span class="nc">Person</span> <span class="n">o1</span><span class="o">,</span> <span class="nc">Person</span> <span class="n">o2</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="n">o2</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">compareTo</span><span class="o">(</span><span class="n">o1</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
        <span class="k">if</span><span class="o">(</span><span class="mi">0</span> <span class="o">==</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">o1</span><span class="o">.</span><span class="na">getId</span><span class="o">()</span> <span class="o">-</span> <span class="n">o2</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>3.应用的环境类</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">strategy</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Environment</span><span class="o">{</span>
    <span class="kd">private</span> <span class="nc">SortInterface</span> <span class="n">sortInterface</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">Environment</span><span class="o">(</span><span class="nc">SortInterface</span> <span class="n">sortInterface</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">sortInterface</span> <span class="o">=</span> <span class="n">sortInterface</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="nf">Environment</span><span class="o">()</span>
<span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setSortInterface</span><span class="o">(</span><span class="nc">SortInterface</span> <span class="n">sortInterface</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">sortInterface</span> <span class="o">=</span> <span class="n">sortInterface</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">sort</span><span class="o">(</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">sortInterface</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">list</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>4．客户端的调用</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">strategy</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Client</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Person</span> <span class="n">p1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Person</span><span class="o">();</span>
        <span class="n">p1</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"Tom"</span><span class="o">);</span>
        <span class="n">p1</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
        <span class="n">p1</span><span class="o">.</span><span class="na">setAge</span><span class="o">(</span><span class="mi">20</span><span class="o">);</span>
        <span class="nc">Person</span> <span class="n">p2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Person</span><span class="o">();</span>
        <span class="n">p2</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"Tonny"</span><span class="o">);</span>
        <span class="n">p2</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
        <span class="n">p2</span><span class="o">.</span><span class="na">setAge</span><span class="o">(</span><span class="mi">50</span><span class="o">);</span>
        <span class="nc">Person</span> <span class="n">p3</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Person</span><span class="o">();</span>
        <span class="n">p3</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"Tom"</span><span class="o">);</span>
        <span class="n">p3</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span>
        <span class="n">p3</span><span class="o">.</span><span class="na">setAge</span><span class="o">(</span><span class="mi">30</span><span class="o">);</span>
        <span class="nc">Person</span> <span class="n">p4</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Person</span><span class="o">();</span>
        <span class="n">p4</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"ABC"</span><span class="o">);</span>
        <span class="n">p4</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">8</span><span class="o">);</span>
        <span class="n">p4</span><span class="o">.</span><span class="na">setAge</span><span class="o">(</span><span class="mi">10</span><span class="o">);</span>
        <span class="nc">Person</span> <span class="n">p5</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Person</span><span class="o">();</span>
        <span class="n">p5</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"Xyz"</span><span class="o">);</span>
        <span class="n">p5</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">9</span><span class="o">);</span>
        <span class="n">p5</span><span class="o">.</span><span class="na">setAge</span><span class="o">(</span><span class="mi">15</span><span class="o">);</span>
        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;();</span>
        <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">p1</span><span class="o">);</span>
        <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">p2</span><span class="o">);</span>
        <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">p3</span><span class="o">);</span>
        <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">p4</span><span class="o">);</span>
        <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">p5</span><span class="o">);</span>
        <span class="nc">Environment</span> <span class="n">env</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Environment</span><span class="o">();</span>
        <span class="nc">UpNameSort</span> <span class="n">uns</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">UpNameSort</span><span class="o">();</span>
        <span class="n">env</span><span class="o">.</span><span class="na">setSortInterface</span><span class="o">(</span><span class="n">uns</span><span class="o">);</span>
        <span class="n">env</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">list</span><span class="o">);</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">list</span><span class="o">.</span><span class="na">size</span><span class="o">();</span> <span class="n">i</span><span class="o">++){</span>
            <span class="nc">Person</span> <span class="n">p</span> <span class="o">=</span> <span class="n">list</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"id: "</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">()</span> <span class="o">+</span> <span class="s">", name: "</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="na">getName</span><span class="o">()</span>
                    <span class="o">+</span> <span class="s">", age:"</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="na">getAge</span><span class="o">());</span>
        <span class="o">}</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"--------------"</span><span class="o">);</span>
        <span class="nc">DownNameSort</span> <span class="n">dns</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DownNameSort</span><span class="o">();</span>
        <span class="n">env</span><span class="o">.</span><span class="na">setSortInterface</span><span class="o">(</span><span class="n">dns</span><span class="o">);</span>
        <span class="n">env</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">list</span><span class="o">);</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">list</span><span class="o">.</span><span class="na">size</span><span class="o">();</span> <span class="n">i</span><span class="o">++){</span>
            <span class="nc">Person</span> <span class="n">p</span> <span class="o">=</span> <span class="n">list</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"id: "</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="na">getId</span><span class="o">()</span> <span class="o">+</span> <span class="s">", name: "</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="na">getName</span><span class="o">()</span>
                    <span class="o">+</span> <span class="s">", age:"</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="na">getAge</span><span class="o">());</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <h3 id="枚举类型">枚举类型</h3> <p><strong>1.枚举的每一个成员就是它一个实例，编译时确定</strong></p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">jdk5</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">enum</span> <span class="nc">Coin</span><span class="o">{</span>
    <span class="n">penny</span><span class="o">(</span><span class="s">"hello"</span><span class="o">),</span> <span class="n">nickel</span><span class="o">(</span><span class="s">"world"</span><span class="o">),</span> <span class="n">dime</span><span class="o">(</span><span class="s">"welcome"</span><span class="o">),</span> <span class="n">quarter</span><span class="o">(</span><span class="s">"hello world"</span><span class="o">);</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">value</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getValue</span><span class="o">(){</span>
        <span class="k">return</span> <span class="n">value</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nc">Coin</span><span class="o">(</span><span class="nc">String</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Coin</span> <span class="n">coin</span> <span class="o">=</span> <span class="nc">Coin</span><span class="o">.</span><span class="na">quarter</span><span class="o">;</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">coin</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p><strong>2.构造EnumMap</strong></p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">jdk5</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.EnumMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EnumMapDemo</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">Action</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">EnumMap</span><span class="o">&lt;</span><span class="nc">Action</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;(</span><span class="nc">Action</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">Action</span><span class="o">.</span><span class="na">TURN_RIGHT</span><span class="o">,</span> <span class="s">"向右转"</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">Action</span><span class="o">.</span><span class="na">SHOOT</span><span class="o">,</span> <span class="s">"射击"</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">Action</span><span class="o">.</span><span class="na">TURN_LEFT</span><span class="o">,</span> <span class="s">"向左转"</span><span class="o">);</span>
        <span class="k">for</span> <span class="o">(</span><span class="nc">Action</span> <span class="n">action</span> <span class="o">:</span> <span class="nc">Action</span><span class="o">.</span><span class="na">values</span><span class="o">()){</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">action</span><span class="o">));</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="kd">enum</span> <span class="nc">Action</span><span class="o">{</span>
    <span class="no">TURN_LEFT</span><span class="o">,</span> <span class="no">TURN_RIGHT</span><span class="o">,</span> <span class="no">SHO</span>
<span class="o">}</span>
</code></pre></div></div> <p><strong>3.构造EnumSet</strong></p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">jdk5</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.EnumSet</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Iterator</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EnumSetDemo2</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">EnumSet</span><span class="o">&lt;</span><span class="nc">FontConstant</span><span class="o">&gt;</span> <span class="n">enumSet</span> <span class="o">=</span> <span class="nc">EnumSet</span><span class="o">.</span><span class="na">noneOf</span><span class="o">(</span><span class="nc">FontConstant</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">enumSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">FontConstant</span><span class="o">.</span><span class="na">Bold</span><span class="o">);</span>
        <span class="n">enumSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">FontConstant</span><span class="o">.</span><span class="na">Italilc</span><span class="o">);</span>
        <span class="n">showEnumSet</span><span class="o">(</span><span class="n">enumSet</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">showEnumSet</span><span class="o">(</span><span class="nc">EnumSet</span><span class="o">&lt;</span><span class="nc">FontConstant</span><span class="o">&gt;</span> <span class="n">enumSet</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span><span class="o">(</span><span class="nc">Iterator</span><span class="o">&lt;</span><span class="nc">FontConstant</span><span class="o">&gt;</span> <span class="n">iter</span> <span class="o">=</span> <span class="n">enumSet</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span> <span class="n">iter</span><span class="o">.</span><span class="na">hasNext</span><span class="o">();){</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">iter</span><span class="o">.</span><span class="na">next</span><span class="o">());</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p><strong>4.构造EnumList</strong></p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">jdk5</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.EnumSet</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Iterator</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EnumSetDemo2</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">EnumSet</span><span class="o">&lt;</span><span class="nc">FontConstant</span><span class="o">&gt;</span> <span class="n">enumSet</span> <span class="o">=</span> <span class="nc">EnumSet</span><span class="o">.</span><span class="na">noneOf</span><span class="o">(</span><span class="nc">FontConstant</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">enumSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">FontConstant</span><span class="o">.</span><span class="na">Bold</span><span class="o">);</span>
        <span class="n">enumSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">FontConstant</span><span class="o">.</span><span class="na">Italilc</span><span class="o">);</span>
        <span class="n">showEnumSet</span><span class="o">(</span><span class="n">enumSet</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">showEnumSet</span><span class="o">(</span><span class="nc">EnumSet</span><span class="o">&lt;</span><span class="nc">FontConstant</span><span class="o">&gt;</span> <span class="n">enumSet</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span><span class="o">(</span><span class="nc">Iterator</span><span class="o">&lt;</span><span class="nc">FontConstant</span><span class="o">&gt;</span> <span class="n">iter</span> <span class="o">=</span> <span class="n">enumSet</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span> <span class="n">iter</span><span class="o">.</span><span class="na">hasNext</span><span class="o">();){</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">iter</span><span class="o">.</span><span class="na">next</span><span class="o">());</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <h3 id="反射">反射</h3> <p><strong>1.使用forName</strong></p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">reflect</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.reflect.Method</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DumpMethods</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">{</span>
        <span class="nc">Class</span><span class="o">&lt;?&gt;</span> <span class="n">classType</span> <span class="o">=</span> <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
        <span class="nc">Method</span><span class="o">[]</span> <span class="n">methods</span> <span class="o">=</span> <span class="n">classType</span><span class="o">.</span><span class="na">getDeclaredMethods</span><span class="o">();</span>
        <span class="k">for</span><span class="o">(</span><span class="nc">Method</span> <span class="n">method</span> <span class="o">:</span> <span class="n">methods</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">method</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p><strong>2.使用.class语法</strong></p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">reflect</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.reflect.Method</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">InvokeTester</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">add</span><span class="o">(</span><span class="kt">int</span> <span class="n">param1</span><span class="o">,</span> <span class="kt">int</span> <span class="n">param2</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">param1</span> <span class="o">+</span> <span class="n">param2</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">echo</span><span class="o">(</span><span class="nc">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"hello: "</span> <span class="o">+</span> <span class="n">message</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">{</span>
        <span class="c1">// InvokeTester test = new InvokeTester();</span>
        <span class="c1">// System.out.println(test.add(1, 2));</span>
        <span class="c1">// System.out.println(test.echo("tom"));</span>
        <span class="nc">Class</span><span class="o">&lt;?&gt;</span> <span class="n">classType</span> <span class="o">=</span> <span class="nc">InvokeTester</span><span class="o">.</span><span class="na">class</span><span class="o">;</span>
        <span class="nc">Object</span> <span class="n">invokeTester</span> <span class="o">=</span> <span class="n">classType</span><span class="o">.</span><span class="na">newInstance</span><span class="o">();</span>
        <span class="c1">// System.out.println(invokeTester instanceof InvokeTester);</span>
        <span class="nc">Method</span> <span class="n">addMethod</span> <span class="o">=</span> <span class="n">classType</span><span class="o">.</span><span class="na">getMethod</span><span class="o">(</span><span class="s">"add"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Class</span><span class="o">[]</span> <span class="o">{</span> <span class="kt">int</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
                <span class="kt">int</span><span class="o">.</span><span class="na">class</span> <span class="o">});</span>
        <span class="nc">Object</span> <span class="n">result</span> <span class="o">=</span> <span class="n">addMethod</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">invokeTester</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">[]{</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">});</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">((</span><span class="nc">Integer</span><span class="o">)</span><span class="n">result</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"---------------------"</span><span class="o">);</span>
        <span class="nc">Method</span> <span class="n">echoMethod</span> <span class="o">=</span> <span class="n">classType</span><span class="o">.</span><span class="na">getMethod</span><span class="o">(</span><span class="s">"echo"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Class</span><span class="o">[]{</span><span class="nc">String</span><span class="o">.</span><span class="na">class</span><span class="o">});</span>
        <span class="nc">Object</span> <span class="n">result2</span> <span class="o">=</span> <span class="n">echoMethod</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">invokeTester</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">[]{</span><span class="s">"tom"</span><span class="o">});</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">((</span><span class="nc">String</span><span class="o">)</span><span class="n">result2</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p><strong>3.利用反射实现对象的拷贝</strong></p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">reflect</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.reflect.Field</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.reflect.Method</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ReflectTester</span><span class="o">{</span>
    <span class="c1">// 该方法实现对Customer对象的拷贝操作</span>
    <span class="kd">public</span> <span class="nc">Object</span> <span class="nf">copy</span><span class="o">(</span><span class="nc">Object</span> <span class="n">object</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">{</span>
        <span class="nc">Class</span><span class="o">&lt;?&gt;</span> <span class="n">classType</span> <span class="o">=</span> <span class="n">object</span><span class="o">.</span><span class="na">getClass</span><span class="o">();</span>
        <span class="nc">Object</span> <span class="n">objectCopy</span> <span class="o">=</span> <span class="n">classType</span><span class="o">.</span><span class="na">getConstructor</span><span class="o">(</span><span class="k">new</span> <span class="nc">Class</span><span class="o">[]</span> <span class="o">{}).</span><span class="na">newInstance</span><span class="o">(</span><span class="k">new</span> <span class="nc">Object</span><span class="o">[]</span> <span class="o">{});</span>
        <span class="c1">// 获得对象的所有成员变量</span>
        <span class="nc">Field</span><span class="o">[]</span> <span class="n">fields</span> <span class="o">=</span> <span class="n">classType</span><span class="o">.</span><span class="na">getDeclaredFields</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="nc">Field</span> <span class="n">field</span> <span class="o">:</span> <span class="n">fields</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
            <span class="nc">String</span> <span class="n">firstLetter</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">).</span><span class="na">toUpperCase</span><span class="o">();</span><span class="c1">// 将属性的首字母转换为大写</span>
            <span class="nc">String</span> <span class="n">getMethodName</span> <span class="o">=</span> <span class="s">"get"</span> <span class="o">+</span> <span class="n">firstLetter</span> <span class="o">+</span> <span class="n">name</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
            <span class="nc">String</span> <span class="n">setMethodName</span> <span class="o">=</span> <span class="s">"set"</span> <span class="o">+</span> <span class="n">firstLetter</span> <span class="o">+</span> <span class="n">name</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
            <span class="nc">Method</span> <span class="n">getMethod</span> <span class="o">=</span> <span class="n">classType</span><span class="o">.</span><span class="na">getMethod</span><span class="o">(</span><span class="n">getMethodName</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Class</span><span class="o">[]</span> <span class="o">{});</span>
            <span class="nc">Method</span> <span class="n">setMethod</span> <span class="o">=</span> <span class="n">classType</span><span class="o">.</span><span class="na">getMethod</span><span class="o">(</span><span class="n">setMethodName</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Class</span><span class="o">[]</span> <span class="o">{</span> <span class="n">field</span><span class="o">.</span><span class="na">getType</span><span class="o">()</span> <span class="o">});</span>
            <span class="nc">Object</span> <span class="n">value</span> <span class="o">=</span> <span class="n">getMethod</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">object</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">[]</span> <span class="o">{});</span>
            <span class="n">setMethod</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">objectCopy</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">[]</span> <span class="o">{</span> <span class="n">value</span> <span class="o">});</span>
        <span class="o">}</span>
        <span class="c1">// 以上两行代码等价于下面一行</span>
        <span class="c1">// Object obj2 = classType.newInstance();</span>
        <span class="c1">// System.out.println(obj);</span>
        <span class="k">return</span> <span class="n">objectCopy</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">{</span>
        <span class="nc">Customer</span> <span class="n">customer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Customer</span><span class="o">(</span><span class="s">"Tom"</span><span class="o">,</span> <span class="mi">20</span><span class="o">);</span>
        <span class="n">customer</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
        <span class="nc">ReflectTester</span> <span class="n">test</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ReflectTester</span><span class="o">();</span>
        <span class="nc">Customer</span> <span class="n">customer2</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Customer</span><span class="o">)</span> <span class="n">test</span><span class="o">.</span><span class="na">copy</span><span class="o">(</span><span class="n">customer</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">customer2</span><span class="o">.</span><span class="na">getId</span><span class="o">()</span> <span class="o">+</span> <span class="s">","</span> <span class="o">+</span> <span class="n">customer2</span><span class="o">.</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">","</span>
                <span class="o">+</span> <span class="n">customer2</span><span class="o">.</span><span class="na">getAge</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="kd">class</span> <span class="nc">Customer</span><span class="o">{</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">age</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">Customer</span><span class="o">(){</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="nf">Customer</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="kt">int</span> <span class="n">age</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">age</span> <span class="o">=</span> <span class="n">age</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="err">…………</span><span class="n">set</span> <span class="err">、</span><span class="n">get</span><span class="err">方法…………</span>
<span class="o">}</span>
</code></pre></div></div> <p><strong>4.创建数组</strong> <br /> 示例1：</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">reflect</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.reflect.Array</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ArrayTester1</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">{</span>
        <span class="nc">Class</span><span class="o">&lt;?&gt;</span> <span class="n">classType</span> <span class="o">=</span> <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">"java.lang.String"</span><span class="o">);</span>
        <span class="c1">//创建一个数组长度为10的数组</span>
        <span class="nc">Object</span> <span class="n">array</span> <span class="o">=</span> <span class="nc">Array</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="n">classType</span><span class="o">,</span> <span class="mi">10</span><span class="o">);</span>
        <span class="c1">//设置数组的第5个元素</span>
        <span class="nc">Array</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">array</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="s">"hello"</span><span class="o">);</span>
        <span class="c1">//取出第5个元素</span>
        <span class="nc">String</span> <span class="n">str</span> <span class="o">=</span> <span class="o">(</span><span class="nc">String</span><span class="o">)</span><span class="nc">Array</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">array</span><span class="o">,</span> <span class="mi">5</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">str</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>示例2：</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">reflect</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.reflect.Array</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ArrayTester2</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="kt">int</span><span class="o">[]</span> <span class="n">dims</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[]</span> <span class="o">{</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">10</span><span class="o">,</span> <span class="mi">15</span> <span class="o">};</span>
        <span class="c1">//创建一个长宽高分别为5、10、15的三维数组</span>
        <span class="nc">Object</span> <span class="n">array</span> <span class="o">=</span> <span class="nc">Array</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="nc">Integer</span><span class="o">.</span><span class="na">TYPE</span><span class="o">,</span> <span class="n">dims</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">array</span> <span class="k">instanceof</span> <span class="kt">int</span><span class="o">[][][]);</span>
        <span class="c1">//获得array的第1维下标为3的component</span>
        <span class="nc">Object</span> <span class="n">arrayObj</span> <span class="o">=</span> <span class="nc">Array</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">array</span><span class="o">,</span> <span class="mi">3</span><span class="o">);</span>
        <span class="c1">//获得arrayObj的第1维下标为5的component，并赋给arrayObj</span>
        <span class="n">arrayObj</span> <span class="o">=</span> <span class="nc">Array</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">arrayObj</span><span class="o">,</span> <span class="mi">5</span><span class="o">);</span>
        <span class="c1">//设置arrayObj第10个元素的值</span>
        <span class="nc">Array</span><span class="o">.</span><span class="na">setInt</span><span class="o">(</span><span class="n">arrayObj</span><span class="o">,</span> <span class="mi">10</span><span class="o">,</span> <span class="mi">37</span><span class="o">);</span>
        <span class="kt">int</span><span class="o">[][][]</span> <span class="n">arrayCast</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">[][][])</span> <span class="n">array</span><span class="o">;</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">arrayCast</span><span class="o">[</span><span class="mi">3</span><span class="o">][</span><span class="mi">5</span><span class="o">][</span><span class="mi">10</span><span class="o">]);</span>
        <span class="c1">// System.out.println(Integer.TYPE);</span>
        <span class="c1">// System.out.println(Integer.class);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <h3 id="代理模式">代理模式</h3> <p><strong>1.静态代理</strong> <br /> 示例1： 抽象角色</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">proxy</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Subject</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">request</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div> <p>真实角色</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">proxy</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RealSubject</span> <span class="kd">extends</span> <span class="nc">Subject</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">request</span><span class="o">(){</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"From real subject."</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>代理角色</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">proxy</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProxySubject</span> <span class="kd">extends</span> <span class="nc">Subject</span><span class="o">{</span>
    <span class="kd">private</span> <span class="nc">RealSubject</span> <span class="n">realSubject</span><span class="o">;</span> <span class="c1">//代理角色内部引用了真实角色</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">request</span><span class="o">(){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">preRequest</span><span class="o">();</span> <span class="c1">//在真实角色操作之前所附加的操作</span>
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span> <span class="o">==</span> <span class="n">realSubject</span><span class="o">){</span>
            <span class="n">realSubject</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">RealSubject</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="n">realSubject</span><span class="o">.</span><span class="na">request</span><span class="o">();</span> <span class="c1">//真实角色所完成的事情</span>
        <span class="k">this</span><span class="o">.</span><span class="na">postRequest</span><span class="o">();</span> <span class="c1">//在真实角色操作之后所附加的操作</span>
    <span class="o">}</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">preRequest</span><span class="o">(){</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"pre request"</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">postRequest</span><span class="o">(){</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"post request"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>客户端</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">proxy</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Client</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="nc">Subject</span> <span class="n">subject</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ProxySubject</span><span class="o">();</span>
        <span class="n">subject</span><span class="o">.</span><span class="na">request</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p><strong>2.动态代理</strong><br /> 创建动态代理的步骤：</p> <blockquote> <p>1.创建一个实现接口InvocationHandler的类，它必须实现invoke方法; 2.创建被代理的类以及接口; 3.通过Proxy的静态方法newProxyInstance(ClassLoader loader, Class[] interfaces,InvocationHandler h) 创建一个代理; 4.通过代理调用方法; 抽象角色与真实角色同上静态代理 动态代理句柄，可以动态的接收真实现角色、并调用真实角色的方法</p> </blockquote> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">dynamicproxy</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.reflect.InvocationHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.reflect.Method</span><span class="o">;</span>
<span class="cm">/**
 该代理类的内部属性是Object类型，实际使用的时候通过该类的构造方法传递进来一个对象
 * 此外，该类还实现了invoke方法，该方法中的method.invoke其实就是调用被代理对象的将要
 * 执行的方法，方法参数是sub，表示该方法从属于sub，通过动态代理类，我们可以在执行真实对象的方法前后
 * 加入自己的一些额外方法。
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DynamicSubject</span> <span class="kd">implements</span> <span class="nc">InvocationHandler</span><span class="o">{</span>
    <span class="kd">private</span> <span class="nc">Object</span> <span class="n">sub</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">DynamicSubject</span><span class="o">(</span><span class="nc">Object</span> <span class="n">obj</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">sub</span> <span class="o">=</span> <span class="n">obj</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="nc">Object</span> <span class="nf">invoke</span><span class="o">(</span><span class="nc">Object</span> <span class="n">proxy</span><span class="o">,</span> <span class="nc">Method</span> <span class="n">method</span><span class="o">,</span> <span class="nc">Object</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span>
            <span class="kd">throws</span> <span class="nc">Throwable</span><span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"before calling: "</span> <span class="o">+</span> <span class="n">method</span><span class="o">);</span>
        <span class="n">method</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">sub</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">args</span> <span class="o">==</span> <span class="kc">null</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"after calling: "</span> <span class="o">+</span> <span class="n">method</span><span class="o">);</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>客户端</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">dynamicproxy</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.reflect.InvocationHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.reflect.Proxy</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Client</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="nc">RealSubject</span> <span class="n">realSubject</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">RealSubject</span><span class="o">();</span>
        <span class="c1">//动态代理句柄类拿到真实对象的引用，并构造一个对象</span>
        <span class="nc">InvocationHandler</span> <span class="n">handler</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DynamicSubject</span><span class="o">(</span><span class="n">realSubject</span><span class="o">);</span>
        <span class="nc">Class</span><span class="o">&lt;?&gt;</span> <span class="n">classType</span> <span class="o">=</span> <span class="n">handler</span><span class="o">.</span><span class="na">getClass</span><span class="o">();</span>
        <span class="c1">//生成代理对象</span>
        <span class="nc">Subject</span> <span class="n">subject</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Subject</span><span class="o">)</span> <span class="nc">Proxy</span><span class="o">.</span><span class="na">newProxyInstance</span><span class="o">(</span>
                <span class="n">classType</span><span class="o">.</span><span class="na">getClassLoader</span><span class="o">(),</span>  <span class="c1">//类加载器</span>
                <span class="n">realSubject</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getInterfaces</span><span class="o">(),</span>  <span class="c1">//真实对象实现的接口</span>
                <span class="n">handler</span><span class="o">);</span>
        <span class="n">subject</span><span class="o">.</span><span class="na">request</span><span class="o">();</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">subject</span><span class="o">.</span><span class="na">getClass</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>自定义一个对Vector的动态代理句柄</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">dynamicproxy</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.reflect.InvocationHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.reflect.Method</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.reflect.Proxy</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Vector</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">VectorProxy</span> <span class="kd">implements</span> <span class="nc">InvocationHandler</span><span class="o">{</span>
    <span class="c1">//这里传入的真实对象将会是Vector的对象</span>
    <span class="kd">private</span> <span class="nc">Object</span> <span class="n">realObj</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">VectorProxy</span><span class="o">(</span><span class="nc">Object</span> <span class="n">obj</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">realObj</span> <span class="o">=</span> <span class="n">obj</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="c1">//构造代理对象</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">Object</span> <span class="nf">factory</span><span class="o">(</span><span class="nc">Object</span> <span class="n">obj</span><span class="o">){</span>
        <span class="nc">Class</span><span class="o">&lt;?&gt;</span> <span class="n">classType</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="na">getClass</span><span class="o">();</span>
        <span class="k">return</span> <span class="nc">Proxy</span><span class="o">.</span><span class="na">newProxyInstance</span><span class="o">(</span><span class="n">classType</span><span class="o">.</span><span class="na">getClassLoader</span><span class="o">(),</span>
                <span class="n">classType</span><span class="o">.</span><span class="na">getInterfaces</span><span class="o">(),</span> <span class="k">new</span> <span class="nc">VectorProxy</span><span class="o">(</span><span class="n">obj</span><span class="o">));</span>
    <span class="o">}</span>
    <span class="c1">//通过代理角色执行方法调用</span>
    <span class="kd">public</span> <span class="nc">Object</span> <span class="nf">invoke</span><span class="o">(</span><span class="nc">Object</span> <span class="n">proxy</span><span class="o">,</span> <span class="nc">Method</span> <span class="n">method</span><span class="o">,</span> <span class="nc">Object</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span>
            <span class="kd">throws</span> <span class="nc">Throwable</span><span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"before calling: "</span> <span class="o">+</span> <span class="n">method</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="kc">null</span> <span class="o">!=</span> <span class="n">args</span><span class="o">){</span>
            <span class="c1">//args是method的参数</span>
            <span class="k">for</span><span class="o">(</span><span class="nc">Object</span> <span class="n">obj</span> <span class="o">:</span> <span class="n">args</span><span class="o">){</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">obj</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="c1">//调用代理角色的目标方法</span>
        <span class="nc">Object</span> <span class="n">object</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">proxyObj</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"after calling: "</span> <span class="o">+</span> <span class="n">method</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">object</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="nc">List</span> <span class="n">v</span> <span class="o">=</span> <span class="o">(</span><span class="nc">List</span><span class="o">)</span><span class="n">factory</span><span class="o">(</span><span class="k">new</span> <span class="nc">Vector</span><span class="o">());</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">v</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>
        <span class="c1">//通过代理对象v间接调用vector的方法</span>
        <span class="n">v</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"New"</span><span class="o">);</span>
        <span class="n">v</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"York"</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">v</span><span class="o">);</span>
        <span class="n">v</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">v</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <h3 id="注解">注解</h3> <p><strong>说明</strong></p> <blockquote> <p>1.自定义注解：当注解中的属性名为 value 时，在对其赋值时可以不指定属性的名称而直接写上属性值即可；除了value 以外的其他值都需要使用 name=value这种赋值方式，即明确指定给谁赋值。 2.当我们使用@interface 关键字定义一个注解时，该注解隐含地继承了java.lang.annotation.Annotation 接口；如果我们定义了一个接口，并且让该接口继承自 Annotation，那么我们所定义的接口依然还是接口而不是注解；Annotation 本身是接口而不是注解。可以与Enum 类比。</p> </blockquote> <p><strong>自定义注解</strong><br /> 示例1<br /> AnnotationTest</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">com</span><span class="p">.</span><span class="n">vvvv</span><span class="p">.</span><span class="n">annotation</span><span class="p">;</span>
<span class="k">public</span> <span class="p">@</span><span class="n">interface</span> <span class="n">AnnotationTest</span><span class="p">{</span>
    <span class="k">String</span><span class="p">[]</span> <span class="n">value1</span><span class="p">()</span> <span class="n">default</span> <span class="s2">"hello"</span><span class="p">;</span>
    <span class="n">EnumTest</span> <span class="n">value2</span><span class="p">();</span>
<span class="p">}</span>
<span class="n">enum</span> <span class="n">EnumTest</span><span class="p">{</span>
    <span class="n">Hello</span><span class="p">,</span> <span class="n">World</span><span class="p">,</span> <span class="n">Welcome</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div> <p>AnnotationUsage</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">com</span><span class="p">.</span><span class="n">vvvv</span><span class="p">.</span><span class="n">annotation</span><span class="p">;</span>
<span class="p">@</span><span class="n">AnnotationTest</span><span class="p">(</span><span class="n">value2</span> <span class="p">=</span> <span class="n">EnumTest</span><span class="p">.</span><span class="n">Welcome</span><span class="p">)</span>
<span class="k">public</span> <span class="n">class</span> <span class="n">AnnotationUsage</span><span class="p">{</span>
    <span class="p">@</span><span class="n">AnnotationTest</span><span class="p">(</span><span class="n">value1</span> <span class="p">=</span> <span class="p">{</span><span class="s2">"world"</span><span class="p">,</span> <span class="s2">"ABCD"</span><span class="p">},</span> <span class="n">value2</span> <span class="p">=</span> <span class="n">EnumTest</span><span class="p">.</span><span class="n">World</span><span class="p">)</span>
    <span class="k">public</span> <span class="n">void</span> <span class="n">method</span><span class="p">(){</span>
        <span class="nf">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s2">"usage of annotation"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="n">static</span> <span class="n">void</span> <span class="n">main</span><span class="p">(</span><span class="k">String</span><span class="p">[]</span> <span class="n">args</span><span class="p">){</span>
        <span class="n">AnnotationUsage</span> <span class="n">usage</span> <span class="p">=</span> <span class="n">new</span> <span class="n">AnnotationUsage</span><span class="p">();</span>
        <span class="n">usage</span><span class="p">.</span><span class="n">method</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p><strong>@Retention及RetentionPolicy的使用</strong><br /> Retention可以指定注解的保留策略，包括Class，Runtime，Source三个范围域上。</p> <p>示例2<br /> MyAnnotation</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">annotation</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.annotation.Retention</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.annotation.RetentionPolicy</span><span class="o">;</span>
<span class="nd">@Retention</span><span class="o">(</span><span class="nc">RetentionPolicy</span><span class="o">.</span><span class="na">CLASS</span><span class="o">)</span>
<span class="kd">public</span> <span class="nd">@interface</span> <span class="nc">MyAnnotation</span><span class="o">{</span>
    <span class="nc">String</span> <span class="nf">hello</span><span class="o">()</span> <span class="k">default</span> <span class="s">"vvvv"</span><span class="o">;</span>
    <span class="nc">String</span> <span class="nf">world</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div> <p>MyTest</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">annotation</span><span class="o">;</span>
<span class="nd">@MyAnnotation</span><span class="o">(</span><span class="n">hello</span> <span class="o">=</span> <span class="s">"beijing"</span><span class="o">,</span> <span class="n">world</span> <span class="o">=</span> <span class="s">"shanghai"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyTest</span><span class="o">{</span>
    <span class="nd">@MyAnnotation</span><span class="o">(</span><span class="n">hello</span> <span class="o">=</span> <span class="s">"tianjin"</span><span class="o">,</span> <span class="n">world</span> <span class="o">=</span> <span class="s">"shangdi"</span><span class="o">)</span>
    <span class="nd">@Deprecated</span>
    <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">output</span><span class="o">(){</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"output something!"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p><strong>利用反向射读取注解信息</strong><br /> 示例3<br /> AccessibleObject, Class, Constructor, Field, Method, Package都实现了AnnotatedElement接口. 定义Annotation时必须设定RetentionPolicy为RUNTIME,也就是可以在VM中读取Annotation信息。以下示例使用反射方式，读取出定义在类上的注解信息。</p> <p>MyRefection</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">annotation</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.annotation.Annotation</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.reflect.Method</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyReflection</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="nc">MyTest</span> <span class="n">myTest</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MyTest</span><span class="o">();</span>
        <span class="nc">Class</span><span class="o">&lt;</span><span class="nc">MyTest</span><span class="o">&gt;</span> <span class="n">c</span> <span class="o">=</span> <span class="nc">MyTest</span><span class="o">.</span><span class="na">class</span><span class="o">;</span>
        <span class="nc">Method</span> <span class="n">method</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="na">getMethod</span><span class="o">(</span><span class="s">"output"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Class</span><span class="o">[]{});</span>
        <span class="c1">//判断这个注解上是否存在MyAnnotation的注解修饰</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">method</span><span class="o">.</span><span class="na">isAnnotationPresent</span><span class="o">(</span><span class="nc">MyAnnotation</span><span class="o">.</span><span class="na">class</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">method</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">myTest</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">[]{});</span>
            <span class="c1">//获得MyAnnotation注解，并取出MyAnnotation注解的值</span>
            <span class="nc">MyAnnotation</span> <span class="n">myAnnotation</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="na">getAnnotation</span><span class="o">(</span><span class="nc">MyAnnotation</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
            <span class="nc">String</span> <span class="n">hello</span> <span class="o">=</span> <span class="n">myAnnotation</span><span class="o">.</span><span class="na">hello</span><span class="o">();</span>
            <span class="nc">String</span> <span class="n">world</span> <span class="o">=</span> <span class="n">myAnnotation</span><span class="o">.</span><span class="na">world</span><span class="o">();</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">hello</span> <span class="o">+</span> <span class="s">", "</span> <span class="o">+</span> <span class="n">world</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="c1">//获得这个方法的所有注解</span>
        <span class="nc">Annotation</span><span class="o">[]</span> <span class="n">annotations</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="na">getAnnotations</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="nc">Annotation</span> <span class="n">annotation</span> <span class="o">:</span> <span class="n">annotations</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">//输出的内容由注解的RetentionPolicy决定</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">annotation</span><span class="o">.</span><span class="na">annotationType</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p><strong>@Target限定注解的使用时机</strong><br /> 使用@Target定义注解的使用时机要指定java.lang.annotation.ElementType，是AccessibleObject,还是 Class, 或者Constructor, Field, Method, Package.<br /> @Retention要搭配一个RetentionPolicy枚举类型, 同样@Target要搭配一个ElmentType 枚举类型。</p> <p>示例4 <br /> MyTarget</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">annotation</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.annotation.ElementType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.annotation.Target</span><span class="o">;</span>
<span class="nd">@Target</span><span class="o">(</span><span class="nc">ElementType</span><span class="o">.</span><span class="na">METHOD</span><span class="o">)</span>
<span class="kd">public</span> <span class="nd">@interface</span> <span class="nc">MyTarget</span><span class="o">{</span>
    <span class="nc">String</span> <span class="nf">value</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div> <p>MyTargetTest</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">annotation</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyTargetTest</span><span class="o">{</span>
    <span class="nd">@MyTarget</span><span class="o">(</span><span class="s">"hello"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doSomething</span><span class="o">(){</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"hello world"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>1.使用java.lang.annotation.Documented修改注解，则可以将注解的信息加入到API文档中。<br /> 2.预设的父类别中的Annotation并不会继承到子类别中，但可以在定义Annotation型态时加上java.lang.annotation.Inherited型态的Annotation.</p> <h2 id="第二部分观察者模式内部类输入输出">第二部分：观察者模式、内部类、输入输出</h2> <h3 id="观察者模式">观察者模式</h3> <p><strong>说明</strong></p> <blockquote> <p>观察者模式的组成</p> <p>– 抽象主题角色：把所有对观察者对象的引用保存在一个集合中，每个抽象主题角色都可以有任意数量的观察者。抽象主题提供一个接口，可以增加和删除观察者角色。一般用一个抽象类或接口来实现。</p> <p>抽象观察者角色：为所有具体的观察者定义一个接口，在得到主题的通知时更新自己。 – 具体主题角色：在具体主题内部状态改变时，给所有登记过的观察者发出通知。具体主题角色通常用一个子类实现。</p> <p>– 具体观察者角色：该角色实现抽象观察者角色所要求的更新接口，以便使本身的状态与主题的状态相协调。如果需要，具体观察者角色可以保存一个指向具体主题角色的引用。通常用一个子类实现。</p> </blockquote> <p><strong>Watched.java</strong></p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">observer</span><span class="o">;</span>
<span class="c1">//抽象主题角色</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Watched</span><span class="o">{</span>
    <span class="c1">//添加观察者</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addWatcher</span><span class="o">(</span><span class="nc">Watcher</span> <span class="n">watcher</span><span class="o">);</span>
    <span class="c1">//删除观察者</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">removeWatcher</span><span class="o">(</span><span class="nc">Watcher</span> <span class="n">watcher</span><span class="o">);</span>
    <span class="c1">//传入指定的字符串,通知观察者</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">notifyWatchers</span><span class="o">(</span><span class="nc">String</span> <span class="n">str</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div> <p><strong>Watcher.java</strong></p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">observer</span><span class="o">;</span>
<span class="c1">//抽象观察者</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Watcher</span><span class="o">{</span>
    <span class="c1">//根据接收到的字符串,更新自已</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="nc">String</span> <span class="n">str</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div> <p><strong>ConcreteWatched.java</strong></p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">observer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="c1">//具体的主题角色</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ConcreteWatched</span> <span class="kd">implements</span> <span class="nc">Watched</span><span class="o">{</span>
    <span class="c1">//观察者集合</span>
    <span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Watcher</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Watcher</span><span class="o">&gt;();</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addWatcher</span><span class="o">(</span><span class="nc">Watcher</span> <span class="n">watcher</span><span class="o">){</span>
        <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">watcher</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">removeWatcher</span><span class="o">(</span><span class="nc">Watcher</span> <span class="n">watcher</span><span class="o">){</span>
        <span class="n">list</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">watcher</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">notifyWatchers</span><span class="o">(</span><span class="nc">String</span> <span class="n">str</span><span class="o">){</span>
        <span class="c1">//遍历观察者集合，并调用观察者的更新方法</span>
        <span class="k">for</span><span class="o">(</span><span class="nc">Watcher</span> <span class="n">watcher</span> <span class="o">:</span> <span class="n">list</span><span class="o">){</span>
            <span class="n">watcher</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">str</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p><strong>ConcreteWatcher.java</strong></p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">observer</span><span class="o">;</span>
<span class="c1">//具体的观察者</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ConcreteWatcher</span> <span class="kd">implements</span> <span class="nc">Watcher</span><span class="o">{</span>
    <span class="c1">//更新</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="nc">String</span> <span class="n">str</span><span class="o">){</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">str</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p><strong>客户端测试类Test.java</strong></p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">observer</span><span class="o">;</span>
        <span class="c1">//客户端</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Test</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="c1">//定义一个美女作为主题</span>
        <span class="nc">Watched</span> <span class="n">girl</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ConcreteWatched</span><span class="o">();</span>
        <span class="c1">//定义三个追求者作为观察者</span>
        <span class="nc">Watcher</span> <span class="n">watcher1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ConcreteWatcher</span><span class="o">();</span>
        <span class="nc">Watcher</span> <span class="n">watcher2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ConcreteWatcher</span><span class="o">();</span>
        <span class="nc">Watcher</span> <span class="n">watcher3</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ConcreteWatcher</span><span class="o">();</span>
        <span class="c1">//将三个追求者添加到对美女的粉丝列表中</span>
        <span class="n">girl</span><span class="o">.</span><span class="na">addWatcher</span><span class="o">(</span><span class="n">watcher1</span><span class="o">);</span>
        <span class="n">girl</span><span class="o">.</span><span class="na">addWatcher</span><span class="o">(</span><span class="n">watcher2</span><span class="o">);</span>
        <span class="n">girl</span><span class="o">.</span><span class="na">addWatcher</span><span class="o">(</span><span class="n">watcher3</span><span class="o">);</span>
        <span class="c1">//当美女发出消息说："开心，爽",将会触发粉丝也跟着说："开心，爽"</span>
        <span class="n">girl</span><span class="o">.</span><span class="na">notifyWatchers</span><span class="o">(</span><span class="s">"开心，爽"</span><span class="o">);</span>
        <span class="c1">//美女从粉丝列表删除第二个粉丝</span>
        <span class="n">girl</span><span class="o">.</span><span class="na">removeWatcher</span><span class="o">(</span><span class="n">watcher2</span><span class="o">);</span>
        <span class="c1">//美女再次发出消息说</span>
        <span class="n">girl</span><span class="o">.</span><span class="na">notifyWatchers</span><span class="o">(</span><span class="s">"不爽"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p><strong>Observable 与 Observer 的应用</strong></p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * An object may be observed by two or more
 * observers.
 */</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
        <span class="c1">// This is the class being observed.</span>
<span class="kd">class</span> <span class="nc">BeingWatched</span> <span class="kd">extends</span> <span class="nc">Observable</span> <span class="o">{</span>
    <span class="kt">void</span> <span class="nf">counter</span><span class="o">(</span><span class="kt">int</span> <span class="n">period</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(;</span> <span class="n">period</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">period</span><span class="o">--)</span> <span class="o">{</span>
            <span class="n">setChanged</span><span class="o">();</span>
            <span class="n">notifyObservers</span><span class="o">(</span><span class="k">new</span> <span class="nc">Integer</span><span class="o">(</span><span class="n">period</span><span class="o">));</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">100</span><span class="o">);</span>
            <span class="o">}</span><span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Sleep interrupted"</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
        <span class="c1">// This is the first observing class.</span>
<span class="kd">class</span> <span class="nc">Watcher1</span> <span class="kd">implements</span> <span class="nc">Observer</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="nc">Observable</span> <span class="n">obj</span><span class="o">,</span> <span class="nc">Object</span> <span class="n">arg</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"watcher1's update() called, count is "</span> <span class="o">+</span>
                <span class="o">(</span> <span class="o">(</span><span class="nc">Integer</span><span class="o">)</span> <span class="n">arg</span><span class="o">).</span><span class="na">intValue</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
        <span class="c1">// This is the second observing class.</span>
<span class="kd">class</span> <span class="nc">Watcher2</span> <span class="kd">implements</span> <span class="nc">Observer</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="nc">Observable</span> <span class="n">obj</span><span class="o">,</span> <span class="nc">Object</span> <span class="n">arg</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span> <span class="o">(</span> <span class="o">(</span><span class="nc">Integer</span><span class="o">)</span> <span class="n">arg</span><span class="o">).</span><span class="na">intValue</span><span class="o">()</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"watcher2's update() called, count is "</span> <span class="o">+</span>
                    <span class="o">(</span> <span class="o">(</span><span class="nc">Integer</span><span class="o">)</span> <span class="n">arg</span><span class="o">).</span><span class="na">intValue</span><span class="o">());</span>
        <span class="o">}</span>
        <span class="c1">// Ring bell when done</span>
        <span class="k">if</span> <span class="o">(</span> <span class="o">(</span> <span class="o">(</span><span class="nc">Integer</span><span class="o">)</span> <span class="n">arg</span><span class="o">).</span><span class="na">intValue</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Done"</span> <span class="o">+</span> <span class="sc">'\7'</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="cm">/**
 * client
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TwoObservers</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span> <span class="n">args</span><span class="o">[])</span> <span class="o">{</span>
        <span class="nc">BeingWatched</span> <span class="n">observed</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BeingWatched</span><span class="o">();</span>
        <span class="nc">Watcher1</span> <span class="n">observing1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Watcher1</span><span class="o">();</span>
        <span class="nc">Watcher2</span> <span class="n">observing2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Watcher2</span><span class="o">();</span>
        <span class="c1">// add both observers</span>
        <span class="n">observed</span><span class="o">.</span><span class="na">addObserver</span><span class="o">(</span><span class="n">observing1</span><span class="o">);</span>
        <span class="n">observed</span><span class="o">.</span><span class="na">addObserver</span><span class="o">(</span><span class="n">observing2</span><span class="o">);</span>
        <span class="n">observed</span><span class="o">.</span><span class="na">counter</span><span class="o">(</span><span class="mi">10</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <h3 id="内部类">内部类</h3> <p><strong>静态内部类</strong></p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">innerclass</span><span class="o">;</span>
<span class="kd">class</span> <span class="nc">StaticInner</span><span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">4</span><span class="o">;</span>
<span class="c1">//静态内部类</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Inner</span><span class="o">{</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">(){</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">a</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">StaticInnerClassTest</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="nc">StaticInner</span><span class="o">.</span><span class="na">Inner</span> <span class="n">inner</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StaticInner</span><span class="o">.</span><span class="na">Inner</span><span class="o">();</span>
        <span class="n">inner</span><span class="o">.</span><span class="na">test</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p><strong>成员内部类</strong></p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">innerclass</span><span class="o">;</span>
<span class="kd">class</span> <span class="nc">MemberInner</span><span class="o">{</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">4</span><span class="o">;</span>
    <span class="c1">//成员内部类</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Inner2</span><span class="o">{</span>
        <span class="kd">private</span> <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">5</span><span class="o">;</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doSomething</span><span class="o">(){</span>
            <span class="c1">//访问内部类的变量a</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">a</span><span class="o">);</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">a</span><span class="o">);</span>
            <span class="c1">//访问外部类的变量a</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="nc">MemberInner</span><span class="o">.</span><span class="na">this</span><span class="o">.</span><span class="na">a</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">method</span><span class="o">(){</span>
        <span class="nc">Inner2</span> <span class="n">inner</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">new</span> <span class="nc">Inner2</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MemberInnerClassTest</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="nc">MemberInner</span><span class="o">.</span><span class="na">Inner2</span> <span class="n">inner</span> <span class="o">=</span> <span class="o">(</span><span class="k">new</span> <span class="nc">MemberInner</span><span class="o">()).</span><span class="na">new</span> <span class="nc">Inner2</span><span class="o">();</span>
        <span class="n">inner</span><span class="o">.</span><span class="na">doSomething</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p><strong>局部内类部</strong></p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">innerclass</span><span class="o">;</span>
<span class="kd">class</span> <span class="nc">LocalInner</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doSomething</span><span class="o">(){</span>
        <span class="c1">//外部类的变量要想被局部内部类访问到，必须定义成终态</span>
        <span class="kd">final</span> <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">4</span><span class="o">;</span>
        <span class="c1">//局部内部类</span>
        <span class="kd">class</span> <span class="nc">Inner3</span><span class="o">{</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">(){</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">a</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">new</span> <span class="nf">Inner3</span><span class="o">().</span><span class="na">test</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LocalInnerClassTest</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="nc">LocalInner</span> <span class="n">localInner</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">LocalInner</span><span class="o">();</span>
        <span class="n">localInner</span><span class="o">.</span><span class="na">doSomething</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p><strong>匿名内部类</strong></p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">innerclass</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AnonymousInnerClassTest</span><span class="o">{</span>
    <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"deprecation"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">get</span><span class="o">(</span><span class="nc">Date</span> <span class="n">date</span><span class="o">){</span>
        <span class="k">return</span> <span class="n">date</span><span class="o">.</span><span class="na">toLocaleString</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="nc">AnonymousInnerClassTest</span> <span class="n">test</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">AnonymousInnerClassTest</span><span class="o">();</span>
        <span class="c1">//String str = test.get(new Date());;</span>
        <span class="c1">//System.out.println(str);</span>
        <span class="c1">//匿名内部类</span>
        <span class="nc">String</span> <span class="n">str</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="k">new</span> <span class="nc">Date</span><span class="o">(){</span>
            <span class="kd">public</span> <span class="nc">String</span> <span class="nf">toLocaleString</span><span class="o">(){</span>
                <span class="k">return</span> <span class="s">"hello world"</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">});</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">str</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <h3 id="输入输出-io">输入输出 I/O</h3> <p><strong>使用FilenameFilter</strong></p> <blockquote> <p>– 希望能够限制由list( )方法返回的文件数目，使它仅返回那些与一定的文件名方式或者过滤(filter)相匹配的文件。为达到这样的目的，必须使用list( )的第二种形式 (方法重载)</p> <p>– String[ ] list(FilenameFilter FFObj)</p> <p>– 该形式中，FFObj是一个实现FilenameFilter接口的类的对象</p> <p>FilenameFilter仅定义了一个方法，accept( )。该方法被列表中的每个文件调用一次。它的通常形式如下：boolean accept(File directory, String filename)</p> <p>当被directory 指定的目录中的文件（也就是说，那些与filename 参数匹配的文件）包含在列表中时，accept( )方法返回true ，当这些文件没有包括在列表中时，accept( )返回false.</p> </blockquote> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">io</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.FilenameFilter</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FileTest7</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="nc">File</span> <span class="n">file</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="s">"C:\\abc\\xyz\\hello"</span><span class="o">);</span>
        <span class="c1">//策略模式的应用</span>
        <span class="nc">String</span><span class="o">[]</span> <span class="n">names</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="k">new</span> <span class="nc">FilenameFilter</span><span class="o">(){</span>
            <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">accept</span><span class="o">(</span><span class="nc">File</span> <span class="n">dir</span><span class="o">,</span> <span class="nc">String</span> <span class="n">name</span><span class="o">){</span>
                <span class="k">if</span><span class="o">(</span><span class="n">name</span><span class="o">.</span><span class="na">endsWith</span><span class="o">(</span><span class="s">".txt"</span><span class="o">)){</span>
                    <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
            <span class="o">};</span>
        <span class="o">});</span>
        <span class="k">for</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span> <span class="o">:</span> <span class="n">names</span><span class="o">){</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p><strong>用InpubStream读取文件</strong></p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">io2</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.FileInputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.InputStream</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">InputStreamTest1</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">{</span>
        <span class="nc">InputStream</span> <span class="n">is</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FileInputStream</span><span class="o">(</span><span class="s">"c:/hello.txt"</span><span class="o">);</span>
        <span class="kt">byte</span><span class="o">[]</span> <span class="n">buffer</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="mi">200</span><span class="o">];</span>
        <span class="kt">int</span> <span class="n">length</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
<span class="c1">//每次从流中读取200个字节放到buffer里，如果最后一次不足200,length即等于</span>
<span class="c1">//实际读到的字节数，如果读指针已经到达文件尾，则返回-1</span>
        <span class="k">while</span><span class="o">(-</span><span class="mi">1</span> <span class="o">!=</span> <span class="o">(</span><span class="n">length</span> <span class="o">=</span> <span class="n">is</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">buffer</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">200</span><span class="o">))){</span>
            <span class="c1">//将buffer中从指定位置0开始、长度为length的字节转换成字符串</span>
            <span class="nc">String</span> <span class="n">str</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">String</span><span class="o">(</span><span class="n">buffer</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span> <span class="n">length</span><span class="o">);</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">str</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">is</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p><strong>递归列出指定目录下的子目录与文件</strong></p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">io2</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
        <span class="c1">//列出指定目录下的目录与文件的层次</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ListAllTest</span><span class="o">{</span>
        <span class="c1">//用于判断目录或文件所处的层次</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">time</span><span class="o">;</span>
        <span class="c1">// 递归的方法</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">deepList</span><span class="o">(</span><span class="nc">File</span> <span class="n">file</span><span class="o">){</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">file</span><span class="o">.</span><span class="na">isFile</span><span class="o">()</span> <span class="o">||</span> <span class="mi">0</span> <span class="o">==</span> <span class="n">file</span><span class="o">.</span><span class="na">listFiles</span><span class="o">().</span><span class="na">length</span><span class="o">){</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span><span class="k">else</span><span class="o">{</span>
            <span class="nc">File</span><span class="o">[]</span> <span class="n">files</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="na">listFiles</span><span class="o">();</span>
            <span class="n">files</span> <span class="o">=</span> <span class="n">sort</span><span class="o">(</span><span class="n">files</span><span class="o">);</span>
            <span class="k">for</span><span class="o">(</span><span class="nc">File</span> <span class="n">f</span> <span class="o">:</span> <span class="n">files</span><span class="o">){</span>
                <span class="nc">StringBuffer</span> <span class="n">output</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuffer</span><span class="o">();</span>
                <span class="k">if</span><span class="o">(</span><span class="n">f</span><span class="o">.</span><span class="na">isFile</span><span class="o">()){</span>
                    <span class="n">output</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">getTabs</span><span class="o">(</span><span class="n">time</span><span class="o">));</span>
                    <span class="n">output</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">f</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
                <span class="o">}</span><span class="k">else</span><span class="o">{</span>
                    <span class="n">output</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">getTabs</span><span class="o">(</span><span class="n">time</span><span class="o">));</span>
                    <span class="n">output</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">f</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
                    <span class="n">output</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"\\"</span><span class="o">);</span>
                <span class="o">}</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">output</span><span class="o">);</span>
                <span class="k">if</span><span class="o">(</span><span class="n">f</span><span class="o">.</span><span class="na">isDirectory</span><span class="o">()){</span>
                    <span class="n">time</span><span class="o">++;</span>
                    <span class="n">deepList</span><span class="o">(</span><span class="n">f</span><span class="o">);</span>
                    <span class="n">time</span><span class="o">--;</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
        <span class="c1">// 整理文件数组，使得目录排在文件之前</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="nc">File</span><span class="o">[]</span> <span class="nf">sort</span><span class="o">(</span><span class="nc">File</span><span class="o">[]</span> <span class="n">files</span><span class="o">){</span>
        <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">File</span><span class="o">&gt;</span> <span class="n">sorted</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">File</span><span class="o">&gt;();</span>
        <span class="c1">// 寻找到所有的目录</span>
        <span class="k">for</span> <span class="o">(</span><span class="nc">File</span> <span class="n">f</span> <span class="o">:</span> <span class="n">files</span><span class="o">){</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">f</span><span class="o">.</span><span class="na">isDirectory</span><span class="o">()){</span>
                <span class="n">sorted</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">f</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="c1">// 寻找到所有的文件</span>
        <span class="k">for</span> <span class="o">(</span><span class="nc">File</span> <span class="n">f</span> <span class="o">:</span> <span class="n">files</span><span class="o">){</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">f</span><span class="o">.</span><span class="na">isFile</span><span class="o">()){</span>
                <span class="n">sorted</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">f</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">sorted</span><span class="o">.</span><span class="na">toArray</span><span class="o">(</span><span class="k">new</span> <span class="nc">File</span><span class="o">[</span><span class="n">files</span><span class="o">.</span><span class="na">length</span><span class="o">]);</span>
    <span class="o">}</span>
        <span class="c1">//判断需要加多少 tab的方法</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">getTabs</span><span class="o">(</span><span class="kt">int</span> <span class="n">time</span><span class="o">){</span>
        <span class="nc">StringBuffer</span> <span class="n">buffer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuffer</span><span class="o">();</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">time</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
            <span class="n">buffer</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"\t"</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">buffer</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="nc">File</span> <span class="n">file</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="s">"C:\\Projects\\wsclient"</span><span class="o">);</span>
        <span class="n">deepList</span><span class="o">(</span><span class="n">file</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <h2 id="第三部分模板方法模式适配器模式命令模式以及组合模式在junit中的应用">第三部分：模板方法模式、适配器模式、命令模式以及组合模式在JUnit中的应用</h2> <h3 id="单元测试junit">单元测试JUnit</h3> <p><strong>说明</strong></p> <blockquote> <p>1.JUnit4 的执行的一般流程：<br /> a)首先获得待测试类所对应的 Class对象。 b)然后通过该 Class对象获得当前类中所有 public 方法所对应的 Method 数组。 c)遍历该Method数组，取得每一个Method对象 d)调用每个Method 对象的isAnnotationPresent(Test.class)方法，判断该方法是否被 Test注解所修饰。 e)如果该方法返回true，那么调用method.invoke()方法去执行该方法，否则不执行。</p> <p>2.测试类的私有方法时可以采取两种方式：<br /> 1）修改方法的访问修饰符，将 private 修改为 default 或 public（但不推荐采取这种方式）。 2）使用反射在测试类中调用目标类的私有方法（推荐）</p> </blockquote> <p><strong>单元测试DeleteAll</strong></p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">junit</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">junit.framework.Assert</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">junit.framework.TestCase</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DeleteAllTest</span> <span class="kd">extends</span> <span class="nc">TestCase</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testDeleteAll</span><span class="o">(){</span>
        <span class="nc">File</span> <span class="n">file</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">try</span><span class="o">{</span>
            <span class="n">file</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="s">"test.txt"</span><span class="o">);</span>
            <span class="n">file</span><span class="o">.</span><span class="na">createNewFile</span><span class="o">();</span>
            <span class="nc">DeleteAll</span><span class="o">.</span><span class="na">deleteAll</span><span class="o">(</span><span class="n">file</span><span class="o">);</span>
        <span class="o">}</span><span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">ex</span><span class="o">){</span>
            <span class="nc">Assert</span><span class="o">.</span><span class="na">fail</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="kt">boolean</span> <span class="n">isExist</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="na">exists</span><span class="o">();</span>
        <span class="nc">Assert</span><span class="o">.</span><span class="na">assertFalse</span><span class="o">(</span><span class="n">isExist</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="cm">/**
     * 构造的是一个目录结构，其结构表示如下
     *
     * d
     * / \
     * / \
     * d1 d2
     * / \
     * / \
     *s1 s2
     *
     */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testDeleteAll2</span><span class="o">(){</span>
        <span class="nc">File</span> <span class="n">directory</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">try</span><span class="o">{</span>
            <span class="n">directory</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="s">"dir"</span><span class="o">);</span>
            <span class="n">directory</span><span class="o">.</span><span class="na">mkdir</span><span class="o">();</span>
            <span class="nc">File</span> <span class="n">file1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="n">directory</span><span class="o">,</span> <span class="s">"file1.txt"</span><span class="o">);</span>
            <span class="nc">File</span> <span class="n">file2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="n">directory</span><span class="o">,</span> <span class="s">"file2.txt"</span><span class="o">);</span>
            <span class="n">file1</span><span class="o">.</span><span class="na">createNewFile</span><span class="o">();</span>
            <span class="n">file2</span><span class="o">.</span><span class="na">createNewFile</span><span class="o">();</span>
            <span class="nc">File</span> <span class="n">d1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="n">directory</span><span class="o">,</span> <span class="s">"d1"</span><span class="o">);</span>
            <span class="nc">File</span> <span class="n">d2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="n">directory</span><span class="o">,</span> <span class="s">"d2"</span><span class="o">);</span>
            <span class="n">d1</span><span class="o">.</span><span class="na">mkdir</span><span class="o">();</span>
            <span class="n">d2</span><span class="o">.</span><span class="na">mkdir</span><span class="o">();</span>
            <span class="nc">File</span> <span class="n">subFile1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="n">d1</span><span class="o">,</span> <span class="s">"subFile1.txt"</span><span class="o">);</span>
            <span class="nc">File</span> <span class="n">subFile2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="n">d2</span><span class="o">,</span> <span class="s">"subFile2.txt"</span><span class="o">);</span>
            <span class="n">subFile1</span><span class="o">.</span><span class="na">createNewFile</span><span class="o">();</span>
            <span class="n">subFile2</span><span class="o">.</span><span class="na">createNewFile</span><span class="o">();</span>
            <span class="nc">DeleteAll</span><span class="o">.</span><span class="na">deleteAll</span><span class="o">(</span><span class="n">directory</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">ex</span><span class="o">){</span>
            <span class="nc">Assert</span><span class="o">.</span><span class="na">fail</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="nc">Assert</span><span class="o">.</span><span class="na">assertNotNull</span><span class="o">(</span><span class="n">directory</span><span class="o">);</span>
        <span class="nc">String</span><span class="o">[]</span> <span class="n">names</span> <span class="o">=</span> <span class="n">directory</span><span class="o">.</span><span class="na">list</span><span class="o">();</span>
        <span class="nc">Assert</span><span class="o">.</span><span class="na">assertEquals</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">names</span><span class="o">.</span><span class="na">length</span><span class="o">);</span>
        <span class="n">directory</span><span class="o">.</span><span class="na">delete</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p><strong>基于注解修饰</strong> <br /> 3.在JUnit 4中， 通过@Before注解实现与JUnit 3.8中的setUp方法同样的功能，通过@After 注解实现与 JUnit 3.8 中的tearDown 方法同样的功能。<br /> 4．在JUnit 4 中，使用@BeforeClass与@AfterClass 注解修饰一个 public static void no-arg 的方法，这样被@BeforeClass 注解所修饰的方法会在所有测试方法执行前执行；被@AfterClass注解所修饰的方法会在所有测试方法执行之后执行。</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@BeforeClass</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">globalInit</span><span class="o">(){</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"globalInit invoked!"</span><span class="o">);</span>
        <span class="o">}</span>
<span class="nd">@AfterClass</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">globalDestroy</span><span class="o">(){</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"globalDestroy invoked!"</span><span class="o">);</span>
        <span class="o">}</span>
</code></pre></div></div> <p>5.@Ignore 注解可用于修饰测试类与测试方法，当修饰测试类时，表示忽略掉类中的所有测试方法；当修饰测试方法时，表示忽略掉该测试方法。<br /> 6.对测试设置期望抛出异常与超时限制,示例: 参数化测试 <br /> 7.参数化测试（Parameters）：当一个测试类使用参数化运行器运行时，需要在类的声明处加上@RunWith(Parameterized.class)注解，表示该类将不使用 JUnit内建的运行器运行，而使用参数化运行器运行；在参数化运行类中提供参数的方法上要使用@Parameters 注解来修饰，同时在测试类的构造方法中为各个参数赋值（构造方法是由 JUnit 调用的），最后编写测试类，它会根据参数的组数来运行测试多次。</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">junit4</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">junit</span><span class="o">.</span><span class="na">Assert</span><span class="o">.</span><span class="na">assertEquals</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collection</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.Before</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.runner.RunWith</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.runners.Parameterized</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.runners.Parameterized.Parameters</span><span class="o">;</span>
<span class="nd">@RunWith</span><span class="o">(</span><span class="nc">Parameterized</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ParametersTest</span><span class="o">{</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">expected</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">input1</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">input2</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">Calculator</span> <span class="n">cal</span><span class="o">;</span>
    <span class="nd">@Parameters</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">Collection</span> <span class="nf">prepareData</span><span class="o">(){</span>
        <span class="nc">Object</span><span class="o">[][]</span> <span class="n">object</span> <span class="o">=</span> <span class="o">{</span> <span class="o">{</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">2</span> <span class="o">},</span> <span class="o">{</span> <span class="o">-</span><span class="mi">4</span><span class="o">,</span> <span class="o">-</span><span class="mi">1</span><span class="o">,</span> <span class="o">-</span><span class="mi">3</span> <span class="o">},</span> <span class="o">{</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span> <span class="o">},</span>
                <span class="o">{</span> <span class="mi">4</span><span class="o">,</span> <span class="o">-</span><span class="mi">4</span><span class="o">,</span> <span class="mi">8</span> <span class="o">}</span> <span class="o">};</span>
        <span class="k">return</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">object</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="nd">@Before</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUp</span><span class="o">(){</span>
        <span class="n">cal</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Calculator</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="c1">//构造方法</span>
    <span class="kd">public</span> <span class="nf">ParametersTest</span><span class="o">(</span><span class="kt">int</span> <span class="n">expected</span><span class="o">,</span> <span class="kt">int</span> <span class="n">input1</span><span class="o">,</span> <span class="kt">int</span> <span class="n">input2</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">expected</span> <span class="o">=</span> <span class="n">expected</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">input1</span> <span class="o">=</span> <span class="n">input1</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">input2</span> <span class="o">=</span> <span class="n">input2</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testAdd</span><span class="o">(){</span>
        <span class="n">assertEquals</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">expected</span><span class="o">,</span> <span class="n">cal</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">input1</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">input2</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <h3 id="测试套件">测试套件</h3> <p>TestSuite（测试套件）:可以将多个测试组合到一起，同时执行多个测试，如下示例:</p> <p><strong>Junit 3的测试套件</strong></p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">junit</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">junit.extensions.RepeatedTest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">junit.framework.Test</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">junit.framework.TestCase</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">junit.framework.TestSuite</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestAll</span> <span class="kd">extends</span> <span class="nc">TestCase</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">Test</span> <span class="nf">suite</span><span class="o">(){</span>
<span class="c1">//测试套件</span>
        <span class="nc">TestSuite</span> <span class="n">suite</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">TestSuite</span><span class="o">();</span>
<span class="c1">//执行几个测试类</span>
        <span class="n">suite</span><span class="o">.</span><span class="na">addTestSuite</span><span class="o">(</span><span class="nc">CalculatorTest</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">suite</span><span class="o">.</span><span class="na">addTestSuite</span><span class="o">(</span><span class="nc">LargestTest</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">suite</span><span class="o">.</span><span class="na">addTestSuite</span><span class="o">(</span><span class="nc">DeleteAllTest</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">suite</span><span class="o">.</span><span class="na">addTest</span><span class="o">(</span><span class="k">new</span> <span class="nc">RepeatedTest</span><span class="o">(</span><span class="k">new</span> <span class="nc">CalculatorTest</span><span class="o">(</span><span class="s">"testSubtract"</span><span class="o">),</span> <span class="mi">20</span><span class="o">));</span>
        <span class="k">return</span> <span class="n">suite</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p><strong>Junit 4测试套件</strong> <br /> 在Junit 4 中使用Suite运行器允许你手动构建一个包含多个测试类的套件，相当于在Junit 3中的static Test suite()方法，使用@Runwith(Suite.class)和@SuiteClasses(TestClass.class, …)注解修饰即可，@Runwith(Suite.class)修饰指明测试的类用Suite套件运行器运行，@SuiteClass指明使用哪些测试套件。</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">junit4</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.runner.RunWith</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.runners.Suite</span><span class="o">;</span>
<span class="nd">@RunWith</span><span class="o">(</span><span class="nc">Suite</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@Suite</span><span class="o">.</span><span class="na">SuiteClasses</span><span class="o">({</span> <span class="nc">CalculatorTest</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="nc">LargestTest</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
        <span class="nc">ParametersTest</span><span class="o">.</span><span class="na">class</span> <span class="o">})</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestAll</span><span class="o">{</span>
<span class="o">}</span>
</code></pre></div></div> <p>在 JUnit 4 中，如果想要同时运行多个测试，需要使用两个注解：@RunWith(Suite.class)以及@Suite.SuiteClasses()，通过这两个注解分别指定使用 Suite 运行器来运行测试，以及指定了运行哪些测试类，其中的@SuiteClasses 中可以继续指定 Suite，这样 JUnit 会再去寻找里面的测试类，一直找到能够执行的 Test Case 并执行之。</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">junit4</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.runner.RunWith</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.runners.Suite</span><span class="o">;</span>
<span class="nd">@RunWith</span><span class="o">(</span><span class="nc">Suite</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@Suite</span><span class="o">.</span><span class="na">SuiteClasses</span><span class="o">(</span><span class="nc">TestAll</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestAll2</span><span class="o">{</span>
<span class="o">}</span>
</code></pre></div></div> <p>在Junit的测试类中，每一个测试方法的运行都会重新执行setUp 与tearDown方法，例如以下测试类CalculatorTest中，如果有n个测试方法，则setUp与tearDown方法就会执行n次,结果会输出n个1。</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CalculatorTest</span> <span class="kd">extends</span> <span class="nc">TestCase</span><span class="o">{</span>
    <span class="kd">private</span> <span class="nc">Calculator</span> <span class="n">cal</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">count</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">CalculatorTest</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">){</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUp</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(++</span><span class="n">count</span><span class="o">);</span>
        <span class="n">cal</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Calculator</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">tearDown</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">{</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testAdd</span><span class="o">(){</span>
        <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="n">cal</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">);</span>
        <span class="nc">Assert</span><span class="o">.</span><span class="na">assertEquals</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="n">result</span><span class="o">);</span>
    <span class="o">}</span>
<span class="err">……</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="c1">//以awt ui风格来运行CalculatorTest测试类</span>
        <span class="c1">//junit.awtui.TestRunner.run(CalculatorTest.class);</span>
        <span class="c1">//以swing ui风格来运行CalculatorTest测试类</span>
        <span class="n">junit</span><span class="o">.</span><span class="na">swingui</span><span class="o">.</span><span class="na">TestRunner</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="nc">CalculatorTest</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <h3 id="模板方法模式template-method">模板方法模式(Template Method)</h3> <p><strong>说明</strong></p> <blockquote> <p>定义 定义一个操作中的算法骨架，而将一些步骤延伸到子类中去，使得子类可以不改变一个算法的结构，即可重新定义该算法的某些特定步骤。这里需要复用的是算法的结构，也就是步骤，而步骤的实现可以在子类中完成。</p> <p>使用场合 1）一次性实现一个算法的不变部分，并且将可变的行为留给子类来完成。 2）各子类公共的行为应该被提取出来并集中到一个公共父类中以避免代码的重复。首先识别现有代码的不同之处，并且把不同部分分离为新的操作，最后，用一个调用这些新的操作的模板方法来替换这些不同的代码。 3）控制子类的扩展</p> <p>模板方法模式的组成 – 父类角色：提供模板。 – 子类角色：为模板提供实现。 模板方法模式在Junit中具体应用,可以在TestCase类中，runBare()方法，首先是执行setUp方法，然后执行runTest方法，最后执行tearDown方法。</p> </blockquote> <h3 id="模板方法模式示例">模板方法模式示例</h3> <p><strong>模板抽象类</strong></p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">pattern</span><span class="o">.</span><span class="na">templatemethod</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">AbstractClass</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">template</span><span class="o">(){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">method1</span><span class="o">();</span>
        <span class="k">this</span><span class="o">.</span><span class="na">method2</span><span class="o">();</span>
        <span class="k">this</span><span class="o">.</span><span class="na">method3</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">method1</span><span class="o">();</span>
    <span class="kd">public</span> <span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">method2</span><span class="o">();</span>
    <span class="kd">public</span> <span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">method3</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div> <p><strong>对模板的具体实现类</strong></p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">pattern</span><span class="o">.</span><span class="na">templatemethod</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ConcreteClass</span> <span class="kd">extends</span> <span class="nc">AbstractClass</span><span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">method1</span><span class="o">(){</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"step 1"</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">method2</span><span class="o">(){</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"step 2"</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">method3</span><span class="o">(){</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"step 3"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p><strong>调用客户端</strong></p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">pattern</span><span class="o">.</span><span class="na">templatemethod</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Client</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="nc">AbstractClass</span> <span class="n">ac</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ConcreteClass</span><span class="o">();</span>
        <span class="n">ac</span><span class="o">.</span><span class="na">template</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <h3 id="适配器模式">适配器模式</h3> <p><strong>说明</strong></p> <blockquote> <p>将一个类的接口转换成客户希望的另外一个接口。Adapter模式使得原本由于接口不兼容而不能一起工作的那些类可以一起工作。</p> <p>适配器模式的构成 目标抽象角色（Target）– 定义客户要用的特定领域的接口 适配器（Adapter）– 调用另一个接口，作为一个转换器 被适配角色（Adaptee）– 定义一个接口，Adapter需要接入 客户端（Client）– 协同对象符合Adapter适配器</p> <p>适配器的分类 有两种类型的适配器模式 – 类适配器（采取继承的方式） – 对象适配器（采取对象组合的方式）推荐使用这种方式</p> </blockquote> <p><strong>适配器模式示例(类适配器,通过继承)</strong> <br /> 抽象目标角色</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">pattern</span><span class="o">.</span><span class="na">adapter</span><span class="o">;</span>
<span class="c1">//目标抽象角色</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Target</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">method1</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div> <p>被适配角色</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">pattern</span><span class="o">.</span><span class="na">adapter</span><span class="o">;</span>
<span class="c1">//要被适配的角色</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Adaptee</span><span class="o">{</span>
<span class="c1">//被适配的目标方法</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">method2</span><span class="o">(){</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"目标方法"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>适配器</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">pattern</span><span class="o">.</span><span class="na">adapter</span><span class="o">;</span>
<span class="c1">//适配器角色(通过继承要被适配的类，实现该适配器对它的适配)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Adapter</span> <span class="kd">extends</span> <span class="nc">Adaptee</span> <span class="kd">implements</span> <span class="nc">Target</span><span class="o">{</span>
<span class="c1">//通过适配器角色的method1间接调用目标方法</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">method1</span><span class="o">(){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">method2</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>客户端</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">pattern</span><span class="o">.</span><span class="na">adapter</span><span class="o">;</span>
<span class="c1">//客户端</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Client</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
<span class="c1">//通过初始化一个适配器调用目标</span>
        <span class="nc">Target</span> <span class="n">target</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Adapter</span><span class="o">();</span>
<span class="c1">//调用目标方法</span>
        <span class="n">target</span><span class="o">.</span><span class="na">method1</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>适配器模式在Junit当中的应用</p> <blockquote> <p>在Junit 中，runTest方法即是适配器的方法，它适配我们具体的测试方法,即通过它，间接的调用了测试类中的测试方法；在runBare方法中，通过runTest方法将我们自己编写的testXXX方法进行了适配，使得JUnit 可以执行我们自己编写的 TestCase，runTest 方法的实现如下：</p> <p>在runTest 方法中，首先获得我们自己编写的 testXXX 方法所对应的Method 对象（不带参数），然后检查该 Method 对象所对应的方法是否是 public 的，如果是则调用Method 对象的invoke 方法来去执行我们自己编写的 testXXX方法。</p> </blockquote> <p><strong>对象组合方式</strong><br /> 抽象目标角色</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">pattern</span><span class="o">.</span><span class="na">adapter2</span><span class="o">;</span>
<span class="c1">//抽象目标角色</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Target</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">method1</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div> <p>被适配者</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">pattern</span><span class="o">.</span><span class="na">adapter2</span><span class="o">;</span>
<span class="c1">//适配器</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Adapter</span> <span class="kd">implements</span> <span class="nc">Target</span><span class="o">{</span>
    <span class="kd">private</span> <span class="nc">Adaptee</span> <span class="n">adaptee</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">Adapter</span><span class="o">(</span><span class="nc">Adaptee</span> <span class="n">adaptee</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">adaptee</span> <span class="o">=</span> <span class="n">adaptee</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">method1</span><span class="o">(){</span>
        <span class="n">adaptee</span><span class="o">.</span><span class="na">method2</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>适配器</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">pattern</span><span class="o">.</span><span class="na">adapter2</span><span class="o">;</span>
<span class="c1">//被适配者</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Adaptee</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">method2</span><span class="o">(){</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"执行方法"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>客户端</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">pattern</span><span class="o">.</span><span class="na">adapter2</span><span class="o">;</span>
<span class="c1">//客户端</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Client</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="nc">Target</span> <span class="n">target</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Adapter</span><span class="o">(</span><span class="k">new</span> <span class="nc">Adaptee</span><span class="o">());</span>
        <span class="n">target</span><span class="o">.</span><span class="na">method1</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p><strong>缺省的适配器模式（AWT，Swing事件模型所采用的模式）</strong> <br /> 抽象目标角色</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">pattern</span><span class="o">.</span><span class="na">defaultadapter</span><span class="o">;</span>
<span class="c1">//抽象目标</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">AbstractService</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">service1</span><span class="o">();</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">service2</span><span class="o">();</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">service3</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div> <p>适配器(缺省的适配器)</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">pattern</span><span class="o">.</span><span class="na">defaultadapter</span><span class="o">;</span>
<span class="c1">//适配器(缺省的适配器,都空实现)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ServiceAdapter</span> <span class="kd">implements</span> <span class="nc">AbstractService</span><span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">service1</span><span class="o">(){</span>
    <span class="o">}</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">service2</span><span class="o">{</span>
    <span class="o">}</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">service3</span><span class="o">(){</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>具体的实现类(具体的适配器)</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">pattern</span><span class="o">.</span><span class="na">defaultadapter</span><span class="o">;</span>
<span class="c1">//具体的实现类</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ConcreteService</span> <span class="kd">extends</span> <span class="nc">ServiceAdapter</span><span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">service1</span><span class="o">(){</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"执行业务方法"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>在awt中的应用（swing与awt事件模型所采用的模式）</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">pattern</span><span class="o">.</span><span class="na">defaultadapter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.awt.Dimension</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.awt.Frame</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.awt.event.MouseEvent</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.awt.event.MouseMotionAdapter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.awt.event.WindowAdapter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.awt.event.WindowEvent</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AwtApp</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="nc">Frame</span> <span class="n">frame</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Frame</span><span class="o">(</span><span class="s">"title"</span><span class="o">);</span>
        <span class="n">frame</span><span class="o">.</span><span class="na">addMouseMotionListener</span><span class="o">(</span><span class="k">new</span> <span class="nc">MouseMotionAdapter</span><span class="o">(){</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">mouseMoved</span><span class="o">(</span><span class="nc">MouseEvent</span> <span class="n">e</span><span class="o">){</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"x: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getX</span><span class="o">()</span> <span class="o">+</span> <span class="s">" y: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getY</span><span class="o">());</span>
            <span class="o">}</span>
        <span class="o">});</span>
        <span class="n">frame</span><span class="o">.</span><span class="na">addWindowListener</span><span class="o">(</span><span class="k">new</span> <span class="nc">WindowAdapter</span><span class="o">(){</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">windowClosing</span><span class="o">(</span><span class="nc">WindowEvent</span> <span class="n">e</span><span class="o">){</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"关闭窗口"</span><span class="o">);</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">});</span>
        <span class="n">frame</span><span class="o">.</span><span class="na">setSize</span><span class="o">(</span><span class="k">new</span> <span class="nc">Dimension</span><span class="o">(</span><span class="mi">50</span><span class="o">,</span> <span class="mi">100</span><span class="o">));</span>
        <span class="n">frame</span><span class="o">.</span><span class="na">setVisible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <h3 id="命令模式">命令模式</h3> <p><strong>说明</strong></p> <blockquote> <p>意图:将一个请求封装为一个对象，从而使你可用不同的请求对客户进行参数化；对请求排队或记录请求日志，以及支持可撤消的操作。</p> <p>作用, 命令模式的构成<br /> 1 客户角色：创建一个具体命令对象，并确定其接收者;<br /> 2 命令角色：声明一个给所有具体命令类的抽象接口。这是一个抽象角色，通常由一个接口或抽象类实现;<br /> 3 具体命令角色：定义一个接收者和行为之间的弱耦合，实现execute方法，负责调用接收者的相应操作; <br /> 4 请求者角色：负责调用命令对象执行请求; <br /> 5 接收者角色：负责具体实施和执行一个请求;</p> </blockquote> <p><strong>命令模式示例</strong> <br /> 抽象命令角色</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">pattern</span><span class="o">.</span><span class="na">command</span><span class="o">;</span>
<span class="c1">//命令对象</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Command</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">execute</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div> <p>命令接收者</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">pattern</span><span class="o">.</span><span class="na">command</span><span class="o">;</span>
<span class="c1">//接收者</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Receiver</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doAction</span><span class="o">(){</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"执行命令操作！"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>具体命令角色</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">pattern</span><span class="o">.</span><span class="na">command</span><span class="o">;</span>
<span class="c1">//具体的命令角色(关联到了接收者)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ConcreteCommand</span> <span class="kd">implements</span> <span class="nc">Command</span><span class="o">{</span>
    <span class="kd">private</span> <span class="nc">Receiver</span> <span class="n">receiver</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">ConcreteCommand</span><span class="o">(</span><span class="nc">Receiver</span> <span class="n">receiver</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">receiver</span> <span class="o">=</span> <span class="n">receiver</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">execute</span><span class="o">(){</span>
        <span class="n">receiver</span><span class="o">.</span><span class="na">doAction</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>命令请求者</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">pattern</span><span class="o">.</span><span class="na">command</span><span class="o">;</span>
<span class="c1">//命令请求者(具体对命令的调用者)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Invoker</span><span class="o">{</span>
    <span class="kd">private</span> <span class="nc">Command</span> <span class="n">command</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">Invoker</span><span class="o">(</span><span class="nc">Command</span> <span class="n">command</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">command</span> <span class="o">=</span> <span class="n">command</span><span class="o">;</span>
    <span class="o">}</span>
<span class="c1">//执行调用操作</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doInvokerAction</span><span class="o">(){</span>
        <span class="n">command</span><span class="o">.</span><span class="na">execute</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>客户端</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">pattern</span><span class="o">.</span><span class="na">command</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Client</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="c1">//接收者</span>
        <span class="nc">Receiver</span> <span class="n">receiver</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Receiver</span><span class="o">();</span>
        <span class="c1">//命令</span>
        <span class="nc">Command</span> <span class="n">command</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ConcreteCommand</span><span class="o">(</span><span class="n">receiver</span><span class="o">);</span>
        <span class="c1">//请求者</span>
        <span class="nc">Invoker</span> <span class="n">invoker</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Invoker</span><span class="o">(</span><span class="n">command</span><span class="o">);</span>
        <span class="c1">//请求者请求</span>
        <span class="n">invoker</span><span class="o">.</span><span class="na">doInvokerAction</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <h3 id="组合模式">组合模式</h3> <p><strong>说明</strong></p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Component（抽象构件接口）  
– 为组合的对象声明接口;  
– 在某些情况下实现从此接口派生出的所有类共有的默认行为;  
– 定义一个接口可以访问及管理它的多个子部件;  

Leaf（叶部件）  
– 在组合中表示叶节点对象，叶节点没有子节点;   
– 定义组合中接口对象的行为;   

Composite（组合类）   
– 定义有子节点（子部件）的部件的行为;    
– 存储子节点（子部件）;   
– 在Component接口中实现与子部件相关的操作;   

Client（客户端）   
– 通过Component接口控制组合部件的对象;   
</code></pre></div></div> <p><strong>组合模式示例</strong><br /> 抽象构件接口</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">pattern</span><span class="o">.</span><span class="na">composite</span><span class="o">;</span>
<span class="c1">//抽象构件接口</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Component</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doSomething</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div> <p>组合类</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">pattern</span><span class="o">.</span><span class="na">composite</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="c1">//组合类（可以存放叶子与组合对象）</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Composite</span> <span class="kd">implements</span> <span class="nc">Component</span><span class="o">{</span>
    <span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Component</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Component</span><span class="o">&gt;();</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="nc">Component</span> <span class="n">component</span><span class="o">){</span>
        <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">component</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">remove</span><span class="o">(</span><span class="nc">Component</span> <span class="n">component</span><span class="o">){</span>
        <span class="n">list</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">component</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Component</span><span class="o">&gt;</span> <span class="nf">getAll</span><span class="o">(){</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">list</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doSomething</span><span class="o">(){</span>
<span class="c1">//遍历</span>
        <span class="k">for</span><span class="o">(</span><span class="nc">Component</span> <span class="n">component</span> <span class="o">:</span> <span class="n">list</span><span class="o">){</span>
            <span class="n">component</span><span class="o">.</span><span class="na">doSomething</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>叶子结点</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">pattern</span><span class="o">.</span><span class="na">composite</span><span class="o">;</span>
<span class="c1">//叶子</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Leaf</span> <span class="kd">implements</span> <span class="nc">Component</span><span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doSomething</span><span class="o">(){</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"执行方法"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>客户端</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">pattern</span><span class="o">.</span><span class="na">composite</span><span class="o">;</span>
<span class="c1">//客户端</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Client</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="nc">Component</span> <span class="n">leaf1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Leaf</span><span class="o">();</span>
        <span class="nc">Component</span> <span class="n">leaf2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Leaf</span><span class="o">();</span>
        <span class="nc">Composite</span> <span class="n">comp1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Composite</span><span class="o">();</span>
        <span class="n">comp1</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">leaf1</span><span class="o">);</span>
        <span class="n">comp1</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">leaf2</span><span class="o">);</span>
        <span class="nc">Component</span> <span class="n">leaf3</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Leaf</span><span class="o">();</span>
        <span class="nc">Component</span> <span class="n">leaf4</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Leaf</span><span class="o">();</span>
        <span class="nc">Composite</span> <span class="n">comp2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Composite</span><span class="o">();</span>
        <span class="n">comp2</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">comp1</span><span class="o">);</span>
        <span class="n">comp2</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">leaf3</span><span class="o">);</span>
        <span class="n">comp2</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">leaf4</span><span class="o">);</span>
        <span class="n">comp2</span><span class="o">.</span><span class="na">doSomething</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p><strong>组合模式的第二种实现</strong> <br /> 抽象构件接口</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">pattern</span><span class="o">.</span><span class="na">composite2</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Component</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doSomething</span><span class="o">();</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="nc">Component</span> <span class="n">component</span><span class="o">);</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">remove</span><span class="o">(</span><span class="nc">Component</span> <span class="n">component</span><span class="o">);</span>
    <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Component</span><span class="o">&gt;</span> <span class="nf">getAll</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div> <p>组合类</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">pattern</span><span class="o">.</span><span class="na">composite2</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Composite</span> <span class="kd">implements</span> <span class="nc">Component</span><span class="o">{</span>
    <span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Component</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Component</span><span class="o">&gt;();</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doSomething</span><span class="o">(){</span>
        <span class="k">for</span><span class="o">(</span><span class="nc">Component</span> <span class="n">component</span> <span class="o">:</span> <span class="n">list</span><span class="o">){</span>
            <span class="n">component</span><span class="o">.</span><span class="na">doSomething</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="nc">Component</span> <span class="n">component</span><span class="o">){</span>
        <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">component</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">remove</span><span class="o">(</span><span class="nc">Component</span> <span class="n">component</span><span class="o">){</span>
        <span class="n">list</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">component</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Component</span><span class="o">&gt;</span> <span class="nf">getAll</span><span class="o">(){</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">list</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>叶子结点</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">vvvv</span><span class="o">.</span><span class="na">pattern</span><span class="o">.</span><span class="na">composite2</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Leaf</span> <span class="kd">implements</span> <span class="nc">Component</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doSomething</span><span class="o">(){</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"执行方法"</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="nc">Component</span> <span class="n">component</span><span class="o">){}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">remove</span><span class="o">(</span><span class="nc">Component</span> <span class="n">component</span><span class="o">){}</span>
    <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Component</span><span class="o">&gt;</span> <span class="nf">getAll</span><span class="o">(){</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p><span class="site-footer-credits">版权所有，转载请注明出处 <a href="https://luowei.github.io/list">luowei.github.io</a>.</span></p> <link rel="stylesheet" href="/list/assets/css/font-awesome.min.css?ver=20151122" /> <!--[if IE 7 ]><link rel="stylesheet" href="/list/assets/css/font-awesome-ie7.min.css?ver=20151122"><![endif]--> <div style="float: right"> <span id="share"> <a class="wechat" target="_blank" title="分享到微信" href="https://chart.apis.google.com/chart?cht=qr&amp;chs=300x300&amp;chl=https%3A%2F%2Fluowei.github.io%2Flist%2Fdocs%2Fjava%2F2012-01-23-%25E5%25B8%25B8%25E7%2594%25A8%25E7%259A%2584%25E8%25AE%25BE%25E8%25AE%25A1%25E6%25A8%25A1%25E5%25BC%258F%25E5%259C%25A8Java%25E4%25B8%25AD%25E7%259A%2584%25E5%25BA%2594%25E7%2594%25A8.html"><i class="icon-large icon-wechat"></i></a> <a class="weibo" target="_blank" title="分享到微博" href="http://service.weibo.com/share/share.php?title=Java-常用的设计模式在Java中的应用 - 知不知&amp;url=https%3A%2F%2Fluowei.github.io%2Flist%2Fdocs%2Fjava%2F2012-01-23-%25E5%25B8%25B8%25E7%2594%25A8%25E7%259A%2584%25E8%25AE%25BE%25E8%25AE%25A1%25E6%25A8%25A1%25E5%25BC%258F%25E5%259C%25A8Java%25E4%25B8%25AD%25E7%259A%2584%25E5%25BA%2594%25E7%2594%25A8.html&amp;type=3&amp;searchPic=1"><i class="icon-large icon-weibo"></i></a> <a class="qzone" target="_blank" title="分享到 QQ 空间" href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=https%3A%2F%2Fluowei.github.io%2Flist%2Fdocs%2Fjava%2F2012-01-23-%25E5%25B8%25B8%25E7%2594%25A8%25E7%259A%2584%25E8%25AE%25BE%25E8%25AE%25A1%25E6%25A8%25A1%25E5%25BC%258F%25E5%259C%25A8Java%25E4%25B8%25AD%25E7%259A%2584%25E5%25BA%2594%25E7%2594%25A8.html&amp;title=Java-常用的设计模式在Java中的应用 - 知不知&amp;summary=常用的设计模式在Java中的应用&amp;site=/list"><i class="icon-large icon-qzone"></i></a> <a class="twitter" target="_blank" title="Share to Twitter" href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fluowei.github.io%2Flist%2Fdocs%2Fjava%2F2012-01-23-%25E5%25B8%25B8%25E7%2594%25A8%25E7%259A%2584%25E8%25AE%25BE%25E8%25AE%25A1%25E6%25A8%25A1%25E5%25BC%258F%25E5%259C%25A8Java%25E4%25B8%25AD%25E7%259A%2584%25E5%25BA%2594%25E7%2594%25A8.html&amp;text=Java-常用的设计模式在Java中的应用 - 知不知&amp;via=luowei010101"><i class="icon-large icon-twitter"></i></a> <a class="facebook" target="_blank" title="Share to Facebook" href="https://www.facebook.com/sharer.php?u=https%3A%2F%2Fluowei.github.io%2Flist%2Fdocs%2Fjava%2F2012-01-23-%25E5%25B8%25B8%25E7%2594%25A8%25E7%259A%2584%25E8%25AE%25BE%25E8%25AE%25A1%25E6%25A8%25A1%25E5%25BC%258F%25E5%259C%25A8Java%25E4%25B8%25AD%25E7%259A%2584%25E5%25BA%2594%25E7%2594%25A8.html&amp;t=Java-常用的设计模式在Java中的应用 - 知不知"><i class="icon-large icon-facebook-sign"></i></a> <a class="googleplus" target="_blank" title="Share to Google+" href="https://plus.google.com/share?url=https%3A%2F%2Fluowei.github.io%2Flist%2Fdocs%2Fjava%2F2012-01-23-%25E5%25B8%25B8%25E7%2594%25A8%25E7%259A%2584%25E8%25AE%25BE%25E8%25AE%25A1%25E6%25A8%25A1%25E5%25BC%258F%25E5%259C%25A8Java%25E4%25B8%25AD%25E7%259A%2584%25E5%25BA%2594%25E7%2594%25A8.html"><i class="icon-large icon-google-plus-sign"></i></a> </span> </div> <hr /> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css" /> <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script> <div id="gitalk-container"></div> <script type="text/javascript"> var gitalk = new Gitalk({ clientID: '9d5ee666269c252cf949', clientSecret: '728cd598f1fca9d8c1df1dfa300057883a3a8676', repo: 'list', owner: 'luowei', admin: ['luowei'], id: decodeURI('Java-常用的设计模式在Java中的应用'), distractionFreeMode: false }); gitalk.render('gitalk-container'); </script> <script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? "https://" : "http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1277627361'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s96.cnzz.com/z_stat.php%3Fid%3D1277627361%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));</script> <footer class="site-footer"> <span class="site-footer-owner"><a href="https://luowei.github.io/list">知不知</a> is maintained by <a href="http://luowei.github.io/list">luowei</a>.</span> <span class="site-footer-credits">Developed by <a href="https://luowei.github.io/list">luowei</a>.</span> </footer> </section> </body> </html>
