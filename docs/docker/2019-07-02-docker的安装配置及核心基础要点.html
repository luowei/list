<!DOCTYPE html> <html lang="en"> <head> <meta charset="UTF-8"> <title>知不知</title> <meta name="viewport" content="width=device-width, initial-scale=1"> <meta name="theme-color" content="#157878"> <meta name="baidu-site-verification" content="" /> <meta name="apple-itunes-app" content="app-id=1227288468, app-argument=https://luowei.github.io/list/docs/docker/2019-07-02-docker%E7%9A%84%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE%E5%8F%8A%E6%A0%B8%E5%BF%83%E5%9F%BA%E7%A1%80%E8%A6%81%E7%82%B9.html"> <link rel="stylesheet" href="https://luowei.github.io/list/assets/css/normalize.css"> <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'> <link rel="stylesheet" href="https://luowei.github.io/list/assets/css/cayman.css"> </head> <body> <section class="page-header"> <h1 class="project-name">知不知</h1> <h2 class="project-tagline"><a style="color:#ffffff;" href="http://luowei.github.io/list">知不知</a> 是一个代码爱好者的技术知识分享部落格。</h2> <a href="http://wodedata.com" target="_blank" class="btn">wodedata</a> <a href="https://luowei.github.io/list" class="btn">home</a> <a href="http://app.wodedata.com" target="_blank" class="btn">APP作品</a> </section> <section class="main-content"> <!-- 标题 --> <h2>docker的安装配置及核心基础要点</h2> <!-- Google Ads --> <script async="" src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <p><ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-8760692904992206" data-ad-slot="2948937366"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script></p> <p><strong>参考：</strong></p> <ul class="task-list"> <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked" />Mac安装卸载Docker <ul class="task-list"> <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked" />删除docker脚本：https://raw.githubusercontent.com/docker/toolbox/master/osx/uninstall.sh</li> <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked" />https://therealmarv.com/how-to-fully-uninstall-the-offical-docker-os-x-installation/</li> </ul> </li> <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked" />Docker — 从入门到实践：<a href="https://docker_practice.gitee.io/zh-cn/">https://docker_practice.gitee.io/zh-cn/</a></li> </ul> <h3 id="初始用户环境">初始用户环境</h3> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>添加用户并创建其家目录
useradd -m luowei

添加用户及家目录并指定使用bash
useradd -m -d /home/luowei/ -s /bin/bash -G sudo luowei

设置密码
passwd luowei

添加到sudo用户组
usermod -aG sudo luowei

查看用户组
groups luowei

删除用户连同家目录也一并删除
deluser --remove-home luowei
</code></pre></div></div> <hr /> <h3 id="docker安装配置">Docker安装配置</h3> <p><strong>使用 APT 安装</strong></p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo apt-get update

$ sudo apt-get install \
    apt-transport-https \
    ca-certificates \
    curl \
    software-properties-common
</code></pre></div></div> <p><strong>添加国内源，添加软件源的 GPG 密钥</strong><br /> <code class="language-plaintext highlighter-rouge">$ curl -fsSL https://mirrors.ustc.edu.cn/docker-ce/linux/ubuntu/gpg | sudo apt-key add -</code></p> <p><strong>向 source.list 中添加 Docker 软件源</strong></p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo add-apt-repository \
    "deb [arch=amd64] https://mirrors.ustc.edu.cn/docker-ce/linux/ubuntu \
    $(lsb_release -cs) \
    stable"
</code></pre></div></div> <p><strong>安装 Docker CE</strong></p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo apt-get update
$ sudo apt-get install docker-ce
</code></pre></div></div> <p><strong>启动 Docker CE</strong></p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo systemctl enable docker
$ sudo systemctl start docker
</code></pre></div></div> <p><strong>将当前用户加入 docker 组：</strong><br /> <code class="language-plaintext highlighter-rouge">$ sudo usermod -aG docker $USER</code></p> <p><strong>配置镜像加速器</strong> 在 /etc/docker/daemon.json 中写入如下内容（如果文件不存在请新建该文件）</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
  "registry-mirrors": [
    "https://dockerhub.azk8s.cn",
    "https://reg-mirror.qiniu.com"
  ]
}
</code></pre></div></div> <p>之后重新启动服务</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo systemctl daemon-reload
$ sudo systemctl restart docker
</code></pre></div></div> <p><strong>获取Ubuntu镜像并运行</strong><br /> 从 Docker 镜像仓库获取镜像的命令是 docker pull。其命令格式为： <code class="language-plaintext highlighter-rouge">docker pull [选项] [Docker Registry 地址[:端口号]/]仓库名[:标签]</code></p> <p>具体的选项可以通过 docker pull –help 命令看到。</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ docker pull ubuntu:18.04
$ docker run -it --rm ubuntu:18.04 bash
</code></pre></div></div> <p>列出镜像<br /> <code class="language-plaintext highlighter-rouge">docker image ls</code></p> <p>镜像体积<br /> <code class="language-plaintext highlighter-rouge">docker system df</code></p> <p><strong>删除本地镜像</strong><br /> 要删除本地的镜像，可以使用 docker image rm 命令，其格式为：<br /> <code class="language-plaintext highlighter-rouge">$ docker image rm [选项] &lt;镜像1&gt; [&lt;镜像2&gt; ...]</code></p> <p>用 ID、镜像名、摘要删除镜像<br /> 其中，<code class="language-plaintext highlighter-rouge">&lt;镜像&gt; 可以是 镜像短 ID、镜像长 ID、镜像名 或者 镜像摘要</code>。</p> <p>更精确的是使用 镜像摘要 删除镜像。<br /> <code class="language-plaintext highlighter-rouge">$ docker image ls --digests</code></p> <p>比如下面根据Id删除<br /> <code class="language-plaintext highlighter-rouge">$ docker image rm 501</code></p> <p>用镜像名，也就是 <仓库名>:<标签>，来删除镜像 `$ docker image rm centos`</标签></仓库名></p> <p>更精确的是使用 镜像摘要 删除镜像<br /> <code class="language-plaintext highlighter-rouge">$ docker image ls --digests</code></p> <p>如果需要删除所有仓库名为 redis 的镜像： <code class="language-plaintext highlighter-rouge">$ docker image rm $(docker image ls -q redis)</code></p> <p>或者删除所有在 mongo:3.2 之前的镜像： <code class="language-plaintext highlighter-rouge">$ docker image rm $(docker image ls -q -f before=mongo:3.2)</code></p> <p><strong>定制一个 Web 服务器为例子</strong><br /> <code class="language-plaintext highlighter-rouge">$ docker run --name webserver -d -p 80:80 nginx</code></p> <p>使用 docker exec命令进入容器，修改其内容</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ docker exec -it webserver bash
root@3729b97e8226:/# echo '&lt;h1&gt;Hello, Docker!&lt;/h1&gt;' &gt; /usr/share/nginx/html/index.html
root@3729b97e8226:/# exit
exit
</code></pre></div></div> <p>修改了容器的文件，也就是改动了容器的存储层。可以通过 docker diff 命令看到具体的改动 <code class="language-plaintext highlighter-rouge">$ docker diff webserver</code></p> <p><strong>docker commit 保存容器的改动</strong> docker commit 的语法格式为： <code class="language-plaintext highlighter-rouge">docker commit [选项] &lt;容器ID或容器名&gt; [&lt;仓库名&gt;[:&lt;标签&gt;]]</code></p> <p>可以用下面的命令将容器保存为镜像： <code class="language-plaintext highlighter-rouge">$ docker commit --author "luowei" --message "修改了默认网页" webserver nginx:v2</code></p> <p>终止容器 <code class="language-plaintext highlighter-rouge">docker container stop webserver</code></p> <p>启动容器 <code class="language-plaintext highlighter-rouge">docker container start webserver</code></p> <p>重启容器 <code class="language-plaintext highlighter-rouge">docker container restart webserver</code></p> <p>从v2、v3镜像启动容器</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ docker run --name webserver_v2 -d -p 80:80 nginx:v2
$ docker run --name webserver_v3 -d -p 80:80 nginx:v3
</code></pre></div></div> <p>让docker在后台运行</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$  docker run -d ubuntu:18.04 /bin/sh -c "while true; do echo hello world; sleep 1; done"
e784987bf3520a7cd8e2fbded60d736555a5d9010dc35630ec02cbab6d0b0cda
</code></pre></div></div> <p>要获取容器的输出信息，可以通过 docker container logs 命令：</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ docker container logs [container ID or NAMES]
$ docker logs e784987bf35	# 输出结果可以用 docker logs 查看
</code></pre></div></div> <p><strong>进入容器</strong> <br /> 使用exec命令<br /> 当 -i -t 参数一起使用时，则可以看到我们熟悉的 Linux 命令提示符<br /> <code class="language-plaintext highlighter-rouge">docker exec -it 69d1 bash</code></p> <p><strong>使用attach命令</strong><br /> 进入后如果从 stdin 中 exit，会导致容器的停止</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker attach [容器Id]
docker attach 5aeb8 
</code></pre></div></div> <p><strong>导出容器</strong> 导出容器快照到本地文件</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker export [容器Id] &gt; ubuntu.tar
docker export e784987bf &gt; ubuntu.tar
</code></pre></div></div> <p><strong>导入容器快照</strong><br /> 使用 docker import 从容器快照文件中再导入为镜像</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cat ubuntu.tar | docker import - test/ubuntu:v1.0
$ docker image ls
</code></pre></div></div> <p>也可以通过指定 URL 或者某个目录来导入，例如 <code class="language-plaintext highlighter-rouge">$ docker import http://example.com/exampleimage.tgz example/imagerepo</code></p> <p>注：<code class="language-plaintext highlighter-rouge">用户既可以使用 docker load 来导入镜像存储文件到本地镜像库，也可以使用 docker import 来导入一个容器快照到本地镜像库</code>。</p> <p><strong>删除容器</strong><br /> 可以使用 docker container rm 来删除一个处于终止状态的容器。例如<br /> <code class="language-plaintext highlighter-rouge">$ docker container rm e78498</code></p> <p>如果要删除一个运行中的容器，可以添加 -f 参数.</p> <p><strong>清理所有处于终止状态的容器</strong><br /> 用 docker container ls -a 命令可以查看所有已经创建的包括终止状态的容器, 用下面的命令可以清理掉所有处于终止状态的容器。<br /> <code class="language-plaintext highlighter-rouge">$ docker container prune</code></p> <p><strong>私有仓库</strong><br /> 安装运行 docker-registry <code class="language-plaintext highlighter-rouge">docker run -d -p 6000:6000 -v /opt/data/registry:/var/lib/registry registry</code></p> <p>使用 docker tag 将 ubuntu:latest 这个镜像标记为 127.0.0.1:5000/ubuntu:latest。 格式为 docker tag IMAGE[:TAG] [REGISTRY_HOST[:REGISTRY_PORT]/]REPOSITORY[:TAG]。 <code class="language-plaintext highlighter-rouge">$ docker tag ubuntu:latest 127.0.0.1:6000/ubuntu:latest</code></p> <p>使用 docker push 上传标记的镜像。 <code class="language-plaintext highlighter-rouge">$ docker push 127.0.0.1:6000/ubuntu:latest</code></p> <p><strong>Nexus3.x 的私有仓库</strong> 使用 Nexus3.x 一个软件来管理 Docker , Maven , Yum , PyPI 等是一个明智的选择.<br /> 启动 Nexus 容器</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ docker run -d --name nexus3 --restart=always \
    -p 8081:8081 \
    --mount src=nexus-data,target=/nexus-data \
    sonatype/nexus3
</code></pre></div></div> <p>可以使用浏览器打开 http://YourIP:8081 访问 Nexus 了,第一次启动 Nexus 的默认帐号是 admin 密码是 admin123.</p> <p><span class="site-footer-credits">版权所有，转载请注明出处 <a href="https://luowei.github.io/list">luowei.github.io</a>.</span></p> <link rel="stylesheet" href="/list/assets/css/font-awesome.min.css?ver=20151122" /> <!--[if IE 7 ]><link rel="stylesheet" href="/list/assets/css/font-awesome-ie7.min.css?ver=20151122"><![endif]--> <div style="float: right"> <span id="share"> <a class="wechat" target="_blank" title="分享到微信" href="https://chart.apis.google.com/chart?cht=qr&amp;chs=300x300&amp;chl=https%3A%2F%2Fluowei.github.io%2Flist%2Fdocs%2Fdocker%2F2019-07-02-docker%25E7%259A%2584%25E5%25AE%2589%25E8%25A3%2585%25E9%2585%258D%25E7%25BD%25AE%25E5%258F%258A%25E6%25A0%25B8%25E5%25BF%2583%25E5%259F%25BA%25E7%25A1%2580%25E8%25A6%2581%25E7%2582%25B9.html"><i class="icon-large icon-wechat"></i></a> <a class="weibo" target="_blank" title="分享到微博" href="http://service.weibo.com/share/share.php?title=docker的安装配置及核心基础要点 - 知不知&amp;url=https%3A%2F%2Fluowei.github.io%2Flist%2Fdocs%2Fdocker%2F2019-07-02-docker%25E7%259A%2584%25E5%25AE%2589%25E8%25A3%2585%25E9%2585%258D%25E7%25BD%25AE%25E5%258F%258A%25E6%25A0%25B8%25E5%25BF%2583%25E5%259F%25BA%25E7%25A1%2580%25E8%25A6%2581%25E7%2582%25B9.html&amp;type=3&amp;searchPic=1"><i class="icon-large icon-weibo"></i></a> <a class="qzone" target="_blank" title="分享到 QQ 空间" href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=https%3A%2F%2Fluowei.github.io%2Flist%2Fdocs%2Fdocker%2F2019-07-02-docker%25E7%259A%2584%25E5%25AE%2589%25E8%25A3%2585%25E9%2585%258D%25E7%25BD%25AE%25E5%258F%258A%25E6%25A0%25B8%25E5%25BF%2583%25E5%259F%25BA%25E7%25A1%2580%25E8%25A6%2581%25E7%2582%25B9.html&amp;title=docker的安装配置及核心基础要点 - 知不知&amp;summary=docker的安装配置及核心基础要点&amp;site=/list"><i class="icon-large icon-qzone"></i></a> <a class="twitter" target="_blank" title="Share to Twitter" href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fluowei.github.io%2Flist%2Fdocs%2Fdocker%2F2019-07-02-docker%25E7%259A%2584%25E5%25AE%2589%25E8%25A3%2585%25E9%2585%258D%25E7%25BD%25AE%25E5%258F%258A%25E6%25A0%25B8%25E5%25BF%2583%25E5%259F%25BA%25E7%25A1%2580%25E8%25A6%2581%25E7%2582%25B9.html&amp;text=docker的安装配置及核心基础要点 - 知不知&amp;via=luowei010101"><i class="icon-large icon-twitter"></i></a> <a class="facebook" target="_blank" title="Share to Facebook" href="https://www.facebook.com/sharer.php?u=https%3A%2F%2Fluowei.github.io%2Flist%2Fdocs%2Fdocker%2F2019-07-02-docker%25E7%259A%2584%25E5%25AE%2589%25E8%25A3%2585%25E9%2585%258D%25E7%25BD%25AE%25E5%258F%258A%25E6%25A0%25B8%25E5%25BF%2583%25E5%259F%25BA%25E7%25A1%2580%25E8%25A6%2581%25E7%2582%25B9.html&amp;t=docker的安装配置及核心基础要点 - 知不知"><i class="icon-large icon-facebook-sign"></i></a> <a class="googleplus" target="_blank" title="Share to Google+" href="https://plus.google.com/share?url=https%3A%2F%2Fluowei.github.io%2Flist%2Fdocs%2Fdocker%2F2019-07-02-docker%25E7%259A%2584%25E5%25AE%2589%25E8%25A3%2585%25E9%2585%258D%25E7%25BD%25AE%25E5%258F%258A%25E6%25A0%25B8%25E5%25BF%2583%25E5%259F%25BA%25E7%25A1%2580%25E8%25A6%2581%25E7%2582%25B9.html"><i class="icon-large icon-google-plus-sign"></i></a> </span> </div> <hr /> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css" /> <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script> <div id="gitalk-container"></div> <script type="text/javascript"> var gitalk = new Gitalk({ clientID: '9d5ee666269c252cf949', clientSecret: '728cd598f1fca9d8c1df1dfa300057883a3a8676', repo: 'list', owner: 'luowei', admin: ['luowei'], id: decodeURI('docker的安装配置及核心基础要点'), distractionFreeMode: false }); gitalk.render('gitalk-container'); </script> <script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? "https://" : "http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1277627361'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s96.cnzz.com/z_stat.php%3Fid%3D1277627361%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));</script> <footer class="site-footer"> <span class="site-footer-owner"><a href="https://luowei.github.io/list">知不知</a> is maintained by <a href="http://luowei.github.io/list">luowei</a>.</span> <span class="site-footer-credits">Developed by <a href="https://luowei.github.io/list">luowei</a>.</span> </footer> </section> </body> </html>
